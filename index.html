<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JobPulse — Find Your Next Tech Job</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg-base: #fafbfd;
      --bg-surface: #ffffff;
      --bg-card: #ffffff;
      --bg-elevated: #f5f5f7;
      --bg-hover: #ebebed;
      --text-primary: #111111;
      --text-secondary: #6b6b6b;
      --text-tertiary: #999999;
      --border: rgba(0,0,0,0.06);
      --border-subtle: rgba(0,0,0,0.03);
      --accent: #5046e5;
      --accent-light: #6366f1;
      --accent-glow: rgba(80,70,229,0.08);
      --green: #059669;
      --green-glow: rgba(5,150,105,0.08);
      --orange: #d97706;
      --orange-glow: rgba(217,119,6,0.08);
      --red: #dc2626;
      --cyan: #0891b2;
      --cyan-glow: rgba(8,145,178,0.08);
      --radius: 16px;
      --radius-sm: 10px;
      --shadow-sm: 0 1px 2px rgba(0,0,0,0.03);
      --shadow: 0 4px 20px rgba(0,0,0,0.04);
      --shadow-lg: 0 8px 40px rgba(0,0,0,0.06);
      --sidebar-width: 280px;
      --ease-smooth: cubic-bezier(0.4, 0, 0.2, 1);
      --ease-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      background: var(--bg-base);
      color: var(--text-primary);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      line-height: 1.7;
      -webkit-font-smoothing: antialiased;
      letter-spacing: -0.01em;
    }

    /* ── Animations ─────────────────────────────── */
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.4; transform: scale(0.95); }
    }
    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    @keyframes float {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      33% { transform: translateY(-15px) rotate(1deg); }
      66% { transform: translateY(-8px) rotate(-1deg); }
    }
    @keyframes breathe {
      0%, 100% { transform: scale(1); opacity: 0.4; }
      50% { transform: scale(1.1); opacity: 0.7; }
    }
    @keyframes gradient-move {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    @keyframes ripple {
      0% { transform: scale(1); opacity: 0.4; }
      100% { transform: scale(2.5); opacity: 0; }
    }
    @keyframes typing {
      from { width: 0; }
      to { width: 100%; }
    }
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0; }
    }
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(100%); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes scaleIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }
    @keyframes wiggle {
      0%, 100% { transform: rotate(0deg); }
      25% { transform: rotate(-3deg); }
      75% { transform: rotate(3deg); }
    }

    /* Scroll-triggered animation classes */
    .reveal {
      opacity: 0;
      transform: translateY(30px);
      transition: all 0.8s var(--ease-smooth);
    }
    .reveal.visible {
      opacity: 1;
      transform: translateY(0);
    }
    .reveal-left {
      opacity: 0;
      transform: translateX(-30px);
      transition: all 0.8s var(--ease-smooth);
    }
    .reveal-left.visible {
      opacity: 1;
      transform: translateX(0);
    }
    .reveal-scale {
      opacity: 0;
      transform: scale(0.95);
      transition: all 0.6s var(--ease-smooth);
    }
    .reveal-scale.visible {
      opacity: 1;
      transform: scale(1);
    }

    /* ── Navbar ─────────────────────────────────── */
    .navbar {
      position: sticky;
      top: 0;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 3rem;
      height: 72px;
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
    }
    .navbar-brand {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--text-primary);
      text-decoration: none;
      letter-spacing: -0.02em;
      transition: all 0.3s var(--ease-smooth);
    }
    .navbar-brand:hover {
      opacity: 0.7;
    }
    .navbar-brand svg {
      width: 24px;
      height: 24px;
      color: var(--accent);
      transition: transform 0.4s var(--ease-bounce);
    }
    .navbar-brand:hover svg {
      transform: rotate(-10deg) scale(1.1);
    }
    .navbar-right {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    .currency-select {
      padding: 0.5rem 0.75rem;
      background: var(--bg-elevated);
      border: none;
      border-radius: 100px;
      font-family: inherit;
      font-size: 0.8rem;
      font-weight: 500;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s var(--ease-smooth);
      outline: none;
    }
    .currency-select:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }
    .navbar-nav {
      display: flex;
      gap: 0.25rem;
    }
    .nav-link {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.6rem 1.25rem;
      background: none;
      border: none;
      border-radius: 100px;
      font-family: inherit;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--text-tertiary);
      cursor: pointer;
      transition: all 0.3s var(--ease-smooth);
      position: relative;
    }
    .nav-link:hover {
      color: var(--text-primary);
    }
    .nav-link:hover svg {
      animation: wiggle 0.5s ease;
    }
    .nav-link.active {
      background: var(--text-primary);
      color: white;
      animation: scaleIn 0.25s var(--ease-bounce);
    }
    .nav-link svg {
      width: 18px;
      height: 18px;
    }
    @media (max-width: 500px) {
      .navbar { padding: 0 1.5rem; }
      .nav-link span { display: none; }
      .nav-link { padding: 0.6rem 0.8rem; }
    }

    /* ── View Toggle ─────────────────────────────── */
    .view { display: none; }
    .view.active { display: block; animation: fadeIn 0.3s ease; }

    /* ── Search Hero ─────────────────────────────── */
    .hero {
      padding: 5rem 2rem 4rem;
      background: linear-gradient(180deg, #f0f4ff 0%, #ffffff 50%, var(--bg-base) 100%);
      text-align: center;
      position: relative;
      overflow: hidden;
      z-index: 1;
    }
    /* Animated gradient mesh */
    .hero::before {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      background:
        radial-gradient(circle at 20% 30%, rgba(80,70,229,0.15) 0%, transparent 40%),
        radial-gradient(circle at 80% 60%, rgba(5,150,105,0.12) 0%, transparent 35%),
        radial-gradient(circle at 60% 80%, rgba(6,182,212,0.1) 0%, transparent 40%);
      pointer-events: none;
      animation: float 20s ease-in-out infinite;
    }
    /* Floating orbs */
    .hero-shapes {
      position: absolute;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
      z-index: 0;
    }
    .hero-orb {
      position: absolute;
      border-radius: 50%;
      filter: blur(80px);
    }
    .hero-orb:nth-child(1) {
      width: 500px;
      height: 500px;
      top: -200px;
      right: 5%;
      background: rgba(80,70,229,0.2);
      animation: float 15s ease-in-out infinite;
    }
    .hero-orb:nth-child(2) {
      width: 400px;
      height: 400px;
      bottom: -150px;
      left: 0%;
      background: rgba(5,150,105,0.15);
      animation: float 18s ease-in-out infinite reverse;
    }
    .hero-orb:nth-child(3) {
      width: 300px;
      height: 300px;
      top: 20%;
      left: 10%;
      background: rgba(6,182,212,0.12);
      animation: breathe 10s ease-in-out infinite;
    }
    /* Floating tech badges */
    .hero-badges {
      position: absolute;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
    }
    .hero-badge {
      position: absolute;
      padding: 0.4rem 0.8rem;
      background: rgba(255,255,255,0.9);
      border: 1px solid rgba(0,0,0,0.06);
      border-radius: 100px;
      font-size: 0.7rem;
      font-weight: 500;
      color: var(--text-secondary);
      box-shadow: 0 2px 10px rgba(0,0,0,0.06);
      animation: float 12s ease-in-out infinite;
    }
    .hero-badge:nth-child(1) { top: 20%; left: 8%; animation-delay: 0s; }
    .hero-badge:nth-child(2) { top: 35%; right: 10%; animation-delay: -2s; }
    .hero-badge:nth-child(3) { bottom: 30%; left: 5%; animation-delay: -4s; }
    .hero-badge:nth-child(4) { top: 15%; right: 15%; animation-delay: -6s; }
    .hero-badge:nth-child(5) { bottom: 25%; right: 8%; animation-delay: -3s; }
    .hero-badge:nth-child(6) { top: 60%; left: 12%; animation-delay: -5s; }
    @media (max-width: 900px) {
      .hero-badges { display: none; }
    }
    .hero-inner {
      max-width: 600px;
      margin: 0 auto;
      animation: fadeUp 0.8s var(--ease-smooth);
      position: relative;
      z-index: 10;
    }
    .hero-eyebrow {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.4rem 1rem;
      background: var(--green-glow);
      border-radius: 100px;
      font-size: 0.75rem;
      font-weight: 500;
      color: var(--green);
      margin-bottom: 2rem;
      letter-spacing: 0.02em;
      animation: fadeUp 0.6s var(--ease-smooth);
    }
    .hero-eyebrow .dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--green);
      position: relative;
    }
    .hero-eyebrow .dot::before {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: 50%;
      background: var(--green);
      animation: ripple 2s ease-out infinite;
    }
    .hero-eyebrow .dot::after {
      content: '';
      position: absolute;
      inset: 2px;
      border-radius: 50%;
      background: var(--green);
      animation: pulse 2s ease-in-out infinite;
    }
    .hero h1 {
      font-size: 3.5rem;
      font-weight: 700;
      letter-spacing: -0.035em;
      line-height: 1.1;
      margin-bottom: 1rem;
      color: var(--text-primary);
      animation: fadeUp 0.8s var(--ease-smooth);
      animation-delay: 0.1s;
      animation-fill-mode: both;
    }
    .hero-subtitle {
      font-size: 1.1rem;
      color: var(--text-secondary);
      margin-bottom: 2.5rem;
      font-weight: 400;
      animation: fadeUp 0.8s var(--ease-smooth);
      animation-delay: 0.15s;
      animation-fill-mode: both;
    }
    .hero-work-type {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      margin-top: 1.25rem;
      animation: fadeUp 0.8s var(--ease-smooth);
      animation-delay: 0.25s;
      animation-fill-mode: both;
    }
    .work-type-btn {
      padding: 0.5rem 1rem;
      background: transparent;
      border: 1px solid var(--border);
      border-radius: 100px;
      font-family: inherit;
      font-size: 0.85rem;
      font-weight: 500;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s var(--ease-smooth);
    }
    .work-type-btn:hover {
      border-color: var(--text-tertiary);
      color: var(--text-primary);
    }
    .work-type-btn.active {
      background: var(--text-primary);
      border-color: var(--text-primary);
      color: white;
    }
    .hero-browse {
      margin-top: 1.5rem;
      font-size: 0.875rem;
      color: var(--text-tertiary);
      animation: fadeUp 0.8s var(--ease-smooth);
      animation-delay: 0.3s;
      animation-fill-mode: both;
    }
    .hero-browse a {
      color: var(--text-secondary);
      text-decoration: none;
      font-weight: 500;
      transition: color 0.3s var(--ease-smooth);
      border-bottom: 1px solid var(--border);
      padding-bottom: 2px;
    }
    .hero-browse a:hover {
      color: var(--text-primary);
      border-color: var(--text-primary);
    }

    /* Hero Search Bar */
    .hero-search {
      display: flex;
      gap: 0.5rem;
      background: #ffffff;
      border: 1px solid rgba(0,0,0,0.08);
      border-radius: 100px;
      padding: 0.5rem;
      transition: all 0.4s var(--ease-smooth);
      animation: fadeUp 0.8s var(--ease-smooth);
      animation-delay: 0.2s;
      animation-fill-mode: both;
      position: relative;
      z-index: 100;
    }
    .hero-search:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow);
      border-color: rgba(0,0,0,0.12);
    }
    .hero-search:focus-within {
      background: #ffffff;
      box-shadow: var(--shadow);
      transform: translateY(-2px);
      border-color: rgba(0,0,0,0.15);
    }
    .hero-search .autocomplete-wrap {
      flex: 1;
      min-width: 0;
    }
    .hero-search .filter-input {
      width: 100%;
      padding: 1rem 1.5rem;
      background: transparent;
      border: none;
      color: var(--text-primary);
      font-size: 0.95rem;
      font-family: inherit;
      outline: none;
    }
    .hero-search .filter-input::placeholder { color: var(--text-tertiary); }
    .hero-search .btn-accent {
      padding: 1rem 2rem;
      flex-shrink: 0;
    }

    @media (max-width: 600px) {
      .hero { padding: 4rem 1.5rem 3rem; }
      .hero h1 { font-size: 2.25rem; }
      .hero-search { flex-direction: column; border-radius: var(--radius); }
      .hero-search .btn-accent { width: 100%; border-radius: var(--radius-sm); }
    }

    /* ── Main Layout (Two-Column) ──────────────────── */
    .main-layout {
      display: grid;
      grid-template-columns: var(--sidebar-width) 1fr;
      gap: 3rem;
      max-width: 1400px;
      margin: 0 auto;
      padding: 3rem;
      background: var(--bg-base);
      position: relative;
      z-index: 2;
    }

    /* ── Filters Sidebar ───────────────────────────── */
    .filters-sidebar {
      position: sticky;
      top: calc(72px + 3rem);
      height: fit-content;
      max-height: calc(100vh - 72px - 6rem);
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      padding-right: 2rem;
      border-right: 1px solid var(--border);
      animation: fadeUp 0.6s var(--ease-smooth);
      animation-delay: 0.1s;
      animation-fill-mode: both;
    }
    .filters-sidebar::-webkit-scrollbar { width: 0; }

    .filter-box {
      background: transparent;
      border: none;
      padding: 0;
      transition: all 0.3s var(--ease-smooth);
    }
    .filter-box-label {
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-tertiary);
      margin-bottom: 1rem;
      display: block;
    }
    .checkbox-group {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .chip {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.6rem 1rem;
      background: var(--bg-elevated);
      border: none;
      border-radius: 100px;
      font-size: 0.8rem;
      font-weight: 450;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.3s var(--ease-smooth);
      user-select: none;
      position: relative;
      overflow: hidden;
    }
    .chip::after {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at center, rgba(0,0,0,0.1) 0%, transparent 70%);
      opacity: 0;
      transition: opacity 0.3s;
    }
    .chip:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
      transform: translateY(-1px);
    }
    .chip:active {
      transform: scale(0.95);
    }
    .chip:active::after {
      opacity: 1;
    }
    label.chip.active,
    .chip.active {
      background: var(--text-primary) !important;
      color: #ffffff !important;
      font-weight: 500;
      animation: scaleIn 0.2s var(--ease-bounce);
    }
    label.chip.active:hover,
    .chip.active:hover {
      opacity: 0.85;
      transform: translateY(-1px);
    }
    .chip input { display: none; }

    .sidebar-salary {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }
    .sidebar-salary .filter-input {
      flex: 1;
      padding: 0.75rem 1rem;
      background: var(--bg-elevated);
      border: none;
      border-radius: 100px;
      color: var(--text-primary);
      font-size: 0.85rem;
      font-family: inherit;
      outline: none;
      transition: all 0.3s var(--ease-smooth);
    }
    .sidebar-salary .filter-input:focus {
      background: var(--bg-hover);
    }
    .sidebar-salary .filter-input::placeholder { color: var(--text-tertiary); }

    .sidebar-source select.filter-input {
      width: 100%;
      padding: 0.75rem 1rem;
      background: var(--bg-elevated);
      border: none;
      border-radius: 100px;
      color: var(--text-primary);
      font-size: 0.85rem;
      font-family: inherit;
      cursor: pointer;
      outline: none;
      transition: all 0.3s var(--ease-smooth);
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23999' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 1rem center;
      padding-right: 2.5rem;
    }
    .sidebar-source select.filter-input:focus {
      background-color: var(--bg-hover);
    }
    .sidebar-source select.filter-input option {
      background: var(--bg-card);
      color: var(--text-primary);
    }

    .btn-clear-filters {
      width: 100%;
      padding: 0.75rem;
      background: transparent;
      border: none;
      border-radius: 100px;
      color: var(--text-tertiary);
      font-size: 0.8rem;
      font-weight: 500;
      font-family: inherit;
      cursor: pointer;
      transition: all 0.3s var(--ease-smooth);
    }
    .btn-clear-filters:hover {
      color: var(--text-primary);
    }

    /* Alert Banner */
    .alert-banner {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem 1.25rem;
      background: linear-gradient(135deg, var(--accent-glow) 0%, rgba(80,70,229,0.08) 100%);
      border: 1px solid rgba(80,70,229,0.15);
      border-radius: var(--radius);
      margin-bottom: 1.5rem;
      position: relative;
      animation: fadeUp 0.5s var(--ease-smooth);
    }
    .alert-banner.hidden { display: none; }
    .alert-banner-icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      background: var(--accent);
      border-radius: 50%;
      flex-shrink: 0;
    }
    .alert-banner-icon svg {
      width: 20px;
      height: 20px;
      color: white;
    }
    .alert-banner-content {
      flex: 1;
      min-width: 0;
    }
    .alert-banner-title {
      font-weight: 600;
      font-size: 0.9rem;
      color: var(--text-primary);
      margin: 0 0 0.15rem 0;
    }
    .alert-banner-desc {
      font-size: 0.8rem;
      color: var(--text-secondary);
      margin: 0;
    }
    .alert-banner-form {
      display: flex;
      gap: 0.5rem;
      flex-shrink: 0;
    }
    .alert-email-input {
      padding: 0.6rem 1rem;
      border: 1px solid var(--border);
      border-radius: 100px;
      font-size: 0.85rem;
      font-family: inherit;
      background: white;
      width: 200px;
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    .alert-email-input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-glow);
    }
    .btn-alert-submit {
      padding: 0.6rem 1.25rem;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 100px;
      font-size: 0.85rem;
      font-weight: 500;
      font-family: inherit;
      cursor: pointer;
      transition: all 0.2s var(--ease-smooth);
      white-space: nowrap;
    }
    .btn-alert-submit:hover {
      background: var(--accent-hover);
      transform: translateY(-1px);
    }
    .btn-alert-submit:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    .alert-banner-close {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      background: none;
      border: none;
      color: var(--text-tertiary);
      cursor: pointer;
      padding: 0.25rem;
      opacity: 0.6;
      transition: opacity 0.2s;
    }
    .alert-banner-close:hover { opacity: 1; }
    .alert-banner-close svg { width: 16px; height: 16px; }
    .alert-banner-success {
      background: var(--green-glow);
      border-color: rgba(5,150,105,0.2);
    }
    .alert-banner-success .alert-banner-icon {
      background: var(--green);
    }
    @media (max-width: 768px) {
      .alert-banner {
        flex-direction: column;
        text-align: center;
        padding: 1.25rem;
      }
      .alert-banner-form {
        width: 100%;
        flex-direction: column;
      }
      .alert-email-input { width: 100%; }
    }

    /* ── Listings Main Area ────────────────────────── */
    .listings-main {
      min-width: 0;
      animation: fadeUp 0.6s var(--ease-smooth);
      animation-delay: 0.2s;
      animation-fill-mode: both;
    }

    /* ── Cards ─────────────────────────────────────── */
    .card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1.75rem;
    }
    .table-section.card {
      padding: 2rem;
      border: none;
      background: transparent;
    }
    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.5rem;
    }
    .card-title {
      font-size: 0.85rem;
      font-weight: 500;
      color: var(--text-secondary);
    }
    .card-badge {
      font-size: 0.7rem;
      font-weight: 500;
      padding: 0.35rem 0.75rem;
      background: var(--bg-elevated);
      border: none;
      border-radius: 100px;
      color: var(--text-tertiary);
    }
    .card-badge.live-badge {
      background: var(--green-glow);
      color: var(--green);
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }
    .card-badge.live-badge::before {
      content: '';
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--green);
      animation: pulse 2s ease-in-out infinite;
    }

    /* ── Job Listings ─────────────────────────────────── */
    .table-section { margin-bottom: 1.5rem; }
    .jobs-list { display: flex; flex-direction: column; gap: 0; }

    .job-card {
      display: grid;
      grid-template-columns: 32px 40px minmax(200px, 2fr) minmax(120px, 1fr) minmax(100px, 1fr) minmax(100px, 140px) 85px 36px;
      gap: 1.25rem;
      align-items: center;
      padding: 1.25rem 0;
      background: transparent;
      border: none;
      border-bottom: 1px solid var(--border-subtle);
      border-radius: 0;
      cursor: pointer;
      transition: all 0.4s var(--ease-smooth);
      text-decoration: none;
      opacity: 0;
      animation: fadeUp 0.5s var(--ease-smooth) forwards;
      position: relative;
    }
    .job-card:last-child {
      border-bottom: none;
    }
    .job-card:hover {
      background: var(--bg-elevated);
      margin: 0 -1.5rem;
      padding: 1.25rem 1.5rem;
      border-radius: var(--radius);
      border-color: transparent;
      transform: scale(1.01);
    }
    .job-card:hover .job-title {
      color: var(--accent);
    }
    .job-card:hover .job-arrow {
      transform: translateX(4px);
    }
    .job-card:active {
      transform: scale(0.99);
    }
    .job-card:nth-child(1) { animation-delay: 0s; }
    .job-card:nth-child(2) { animation-delay: 0.02s; }
    .job-card:nth-child(3) { animation-delay: 0.04s; }
    .job-card:nth-child(4) { animation-delay: 0.06s; }
    .job-card:nth-child(5) { animation-delay: 0.08s; }
    .job-card:nth-child(6) { animation-delay: 0.1s; }
    .job-card:nth-child(7) { animation-delay: 0.12s; }
    .job-card:nth-child(8) { animation-delay: 0.14s; }
    .job-card:nth-child(9) { animation-delay: 0.16s; }
    .job-card:nth-child(10) { animation-delay: 0.18s; }
    .job-card:hover .job-arrow { opacity: 1; }

    .job-main { display: flex; flex-direction: column; gap: 0.25rem; min-width: 0; }
    .job-title {
      font-size: 0.9rem;
      font-weight: 500;
      color: var(--text-primary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      transition: color 0.3s var(--ease-smooth);
    }
    .job-company {
      display: flex;
      align-items: center;
      gap: 0.35rem;
      font-size: 0.8rem;
      color: var(--text-tertiary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .job-company svg { width: 13px; height: 13px; opacity: 0.4; flex-shrink: 0; }

    .company-avatar {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.85rem;
      font-weight: 600;
      flex-shrink: 0;
      text-transform: uppercase;
      letter-spacing: -0.02em;
    }

    .job-location {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
      font-size: 0.85rem;
      color: var(--text-secondary);
      min-width: 0;
    }
    .job-location-text {
      display: flex;
      align-items: center;
      gap: 0.35rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .job-location svg { width: 14px; height: 14px; opacity: 0.4; flex-shrink: 0; }

    .work-type {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.2rem 0.5rem;
      border-radius: 100px;
      font-size: 0.65rem;
      font-weight: 500;
      width: fit-content;
      text-transform: uppercase;
      letter-spacing: 0.03em;
    }
    .work-type.remote {
      background: var(--green-glow);
      color: var(--green);
    }
    .work-type.hybrid {
      background: var(--orange-glow);
      color: var(--orange);
    }
    .work-type.onsite {
      background: var(--bg-elevated);
      color: var(--text-tertiary);
    }
    .work-type svg { width: 10px; height: 10px; }

    .job-tags { display: flex; gap: 0.35rem; flex-wrap: wrap; }

    .job-salary {
      font-size: 0.85rem;
      font-weight: 500;
      color: var(--text-primary);
      white-space: nowrap;
      text-align: right;
    }
    .job-salary.none {
      font-size: 0.8rem;
      font-weight: 400;
      color: var(--text-tertiary);
    }

    .job-source {
      padding: 0.3rem 0.6rem;
      border-radius: 100px;
      font-size: 0.65rem;
      font-weight: 600;
      text-align: center;
      white-space: nowrap;
      background: var(--bg-elevated);
      color: var(--text-tertiary);
    }
    .job-source.remoteok { background: var(--green-glow); color: var(--green); }
    .job-source.arbeitnow { background: var(--bg-elevated); color: var(--text-tertiary); }
    .job-source.jobicy { background: var(--orange-glow); color: var(--orange); }
    .job-source.weworkremotely { background: rgba(59,130,246,0.1); color: #3b82f6; }
    .job-source.adzuna { background: rgba(168,85,247,0.1); color: #a855f7; }

    .job-arrow {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      color: var(--text-tertiary);
      opacity: 0;
      transition: all 0.3s var(--ease-smooth);
    }
    .job-arrow svg { width: 18px; height: 18px; }

    .tag {
      display: inline-block;
      padding: 0.2rem 0.5rem;
      background: var(--bg-elevated);
      color: var(--text-secondary);
      border-radius: 100px;
      font-size: 0.7rem;
      font-weight: 450;
    }

    .no-results {
      text-align: center;
      padding: 4rem 1rem;
      color: var(--text-tertiary);
      font-size: 0.95rem;
    }

    /* Header row for job listings */
    .jobs-header {
      display: grid;
      grid-template-columns: 32px minmax(200px, 2fr) minmax(120px, 1fr) minmax(100px, 1fr) minmax(100px, 140px) 85px 36px;
      gap: 1.5rem;
      padding: 0 0 1rem;
      font-size: 0.7rem;
      font-weight: 500;
      color: var(--text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      border-bottom: 1px solid var(--border-subtle);
      margin-bottom: 0;
    }
    .jobs-header span:nth-child(5),
    .jobs-header span:nth-child(6) { text-align: right; }

    .col-filter {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      cursor: pointer;
      padding: 0.25rem 0.5rem;
      margin: -0.25rem -0.5rem;
      border-radius: 6px;
      transition: all 0.2s;
      user-select: none;
    }
    .col-filter:hover { background: var(--bg-elevated); color: var(--text-secondary); }
    .col-filter.active { background: var(--accent-glow); color: var(--accent); }
    .col-filter svg { width: 13px; height: 13px; opacity: 0.6; }
    .col-filter.active svg { opacity: 1; }

    .pagination {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1.5rem;
      padding: 2.5rem 0 1rem;
    }
    #page-info { font-size: 0.8rem; color: var(--text-tertiary); font-weight: 450; }

    /* ── Listing Tabs ─────────────────────────────── */
    .listing-tabs {
      display: flex;
      gap: 0;
    }
    .listing-tab {
      padding: 0.5rem 1rem;
      background: none;
      border: none;
      border-radius: 100px;
      font-family: inherit;
      font-size: 0.85rem;
      font-weight: 500;
      color: var(--text-tertiary);
      cursor: pointer;
      position: relative;
      transition: all 0.3s var(--ease-smooth);
    }
    .listing-tab:hover {
      color: var(--text-secondary);
    }
    .listing-tab.active {
      color: var(--text-primary);
      background: var(--bg-elevated);
    }
    .listing-tab .saved-count {
      font-size: 0.75rem;
      color: inherit;
      opacity: 0.6;
    }

    /* ── Bookmark Button ─────────────────────────── */
    .bookmark-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      background: none;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      color: var(--text-tertiary);
      opacity: 0.3;
      transition: all 0.3s var(--ease-smooth);
      padding: 0;
      flex-shrink: 0;
    }
    .bookmark-btn:hover {
      opacity: 1;
      color: var(--text-primary);
    }
    .bookmark-btn.saved { opacity: 1; color: var(--text-primary); }
    .bookmark-btn.saved svg { fill: var(--text-primary); }
    .bookmark-btn svg { width: 16px; height: 16px; }
    @keyframes bookmark-pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.15); }
      100% { transform: scale(1); }
    }
    .bookmark-btn.pulse-anim {
      animation: bookmark-pulse 0.3s var(--ease-bounce);
    }

    /* ── Buttons ───────────────────────────────────── */
    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 100px;
      font-weight: 500;
      font-size: 0.875rem;
      font-family: inherit;
      cursor: pointer;
      transition: all 0.3s var(--ease-smooth);
    }
    .btn:active { transform: scale(0.96); }
    .btn-accent {
      background: var(--text-primary);
      color: white;
      position: relative;
      overflow: hidden;
    }
    .btn-accent::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255,255,255,0.2);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }
    .btn-accent:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }
    .btn-accent:hover::before {
      width: 300px;
      height: 300px;
    }
    .btn-ghost {
      background: var(--bg-elevated);
      color: var(--text-secondary);
      border: none;
    }
    .btn-ghost:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }
    .btn-sm { padding: 0.5rem 1rem; font-size: 0.8rem; }
    .btn-sm:disabled { opacity: 0.3; cursor: default; pointer-events: none; }

    /* ── Analytics View ────────────────────────────── */
    .analytics-view {
      max-width: 1400px;
      margin: 0 auto;
      padding: 3rem;
    }
    .analytics-header {
      margin-bottom: 3rem;
      animation: fadeUp 0.6s var(--ease-smooth);
    }
    .analytics-header h2 {
      font-size: 2rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      letter-spacing: -0.03em;
      color: var(--text-primary);
    }
    .analytics-header p {
      font-size: 0.9rem;
      color: var(--text-tertiary);
    }

    /* ── Insight Grid ──────────────────────────────── */
    .insight-grid {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 2rem;
      margin-bottom: 2rem;
    }
    .insight-grid .card,
    .charts-grid .card {
      transition: all 0.3s var(--ease-smooth);
      box-shadow: none;
      border: 1px solid var(--border);
    }
    .insight-grid .card:hover,
    .charts-grid .card:hover {
      border-color: var(--bg-hover);
      background: var(--bg-elevated);
    }
    .doughnut-wrap {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .doughnut-wrap canvas { max-width: 200px; max-height: 200px; }
    .insight-list { list-style: none; }
    .insight-list li {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.55rem 0;
      border-bottom: 1px solid var(--border-subtle);
      font-size: 0.85rem;
    }
    .insight-list li:last-child { border-bottom: none; }
    .insight-list .rank {
      width: 1.4rem;
      height: 1.4rem;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-elevated);
      border-radius: 6px;
      font-size: 0.68rem;
      font-weight: 700;
      color: var(--text-tertiary);
      flex-shrink: 0;
    }
    .insight-list li:nth-child(1) .rank { background: var(--accent-glow); color: var(--accent); }
    .insight-list li:nth-child(2) .rank { background: var(--green-glow); color: var(--green); }
    .insight-list li:nth-child(3) .rank { background: var(--orange-glow); color: var(--orange); }
    .insight-list .label { color: var(--text-secondary); flex: 1; margin-left: 0.6rem; }
    .insight-list .value { font-weight: 700; color: var(--text-primary); }

    /* ── Charts Grid ──────────────────────────────── */
    .charts-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
    }
    .chart-card { min-height: 300px; }
    .chart-card canvas { max-height: 250px; }

    /* ── Autocomplete ─────────────────────────────── */
    .autocomplete-wrap { position: relative; z-index: 100; }
    .autocomplete-list {
      position: absolute;
      top: calc(100% + 8px);
      left: 0;
      right: 0;
      background-color: #fff;
      border: 1px solid rgba(0,0,0,0.1);
      border-radius: var(--radius-sm);
      max-height: 280px;
      overflow-y: auto;
      z-index: 9999;
      display: none;
      box-shadow: 0 10px 50px rgba(0,0,0,0.15);
      backdrop-filter: none;
      -webkit-backdrop-filter: none;
    }
    .autocomplete-list.show { display: block; animation: scaleIn 0.15s var(--ease-smooth); }
    .autocomplete-item {
      padding: 0.85rem 1.25rem;
      font-size: 0.9rem;
      color: var(--text-primary);
      cursor: pointer;
      transition: background 0.15s var(--ease-smooth);
      border-bottom: 1px solid rgba(0,0,0,0.05);
      background-color: #fff;
    }
    .autocomplete-item:last-child {
      border-bottom: none;
    }
    .autocomplete-item:hover, .autocomplete-item.active {
      background-color: #f5f5f7;
    }
    .autocomplete-item mark {
      background: transparent;
      color: var(--accent);
      font-weight: 600;
    }

    /* ── Footer ────────────────────────────────────── */
    footer {
      text-align: center;
      padding: 4rem 2rem;
      color: var(--text-tertiary);
      font-size: 0.8rem;
      margin-top: 2rem;
    }
    footer p { margin-bottom: 1.5rem; }
    footer a { color: var(--text-secondary); text-decoration: none; transition: color 0.3s var(--ease-smooth); }
    footer a:hover { color: var(--text-primary); }
    .footer-tech {
      display: flex;
      justify-content: center;
      gap: 2rem;
      flex-wrap: wrap;
    }
    .footer-tech span {
      font-weight: 450;
      font-size: 0.75rem;
      color: var(--text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    /* ── Loading ────────────────────────────────────── */
    .loading-cell {
      text-align: center;
      padding: 3rem;
      color: var(--text-tertiary);
    }
    .spinner {
      display: inline-block;
      width: 20px; height: 20px;
      border: 2px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.6s linear infinite;
      margin-right: 0.5rem;
      vertical-align: middle;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Skeleton Loading */
    .skeleton {
      background: linear-gradient(90deg, var(--bg-elevated) 25%, var(--bg-hover) 50%, var(--bg-elevated) 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
      border-radius: 8px;
    }
    .skeleton-card {
      display: grid;
      grid-template-columns: 32px 1fr 1fr 100px;
      gap: 1.25rem;
      align-items: center;
      padding: 1.1rem 1.5rem;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
    }
    .skeleton-loading { display: flex; flex-direction: column; gap: 0.6rem; }
    .skeleton-bookmark { width: 32px; height: 32px; border-radius: 8px; }
    .skeleton-content { display: flex; flex-direction: column; gap: 0.5rem; }
    .skeleton-title { height: 18px; width: 70%; }
    .skeleton-subtitle { height: 14px; width: 50%; }
    .skeleton-location { height: 16px; width: 80%; }
    .skeleton-salary { height: 18px; width: 60px; margin-left: auto; }

    /* ── Animate in ────────────────────────────────── */
    .fade-in {
      opacity: 0;
      transform: translateY(12px);
      animation: fadeIn 0.5s ease forwards;
    }
    @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
    .fade-in:nth-child(1) { animation-delay: 0s; }
    .fade-in:nth-child(2) { animation-delay: 0.06s; }
    .fade-in:nth-child(3) { animation-delay: 0.12s; }
    .fade-in:nth-child(4) { animation-delay: 0.18s; }

    /* ── Responsive ────────────────────────────────── */
    @media (max-width: 1100px) {
      .job-card { grid-template-columns: 28px 36px 1fr auto auto; }
      .company-avatar { width: 36px; height: 36px; font-size: 0.75rem; }
      .job-location, .job-tags, .jobs-header { display: none; }
    }
    @media (max-width: 900px) {
      .main-layout {
        grid-template-columns: 1fr;
        padding: 2rem 1.5rem;
      }
      .filters-sidebar {
        position: static;
        max-height: none;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 1.5rem 2rem;
        padding-right: 0;
        padding-bottom: 2rem;
        border-right: none;
        border-bottom: 1px solid var(--border-subtle);
        margin-bottom: 1rem;
      }
      .filter-box {
        flex: 1;
        min-width: 180px;
      }
      .insight-grid { grid-template-columns: 1fr; }
      .charts-grid { grid-template-columns: 1fr; }
      .analytics-view { padding: 2rem 1.5rem; }
    }
    @media (max-width: 600px) {
      .job-card {
        grid-template-columns: 28px 32px 1fr auto;
        padding: 1rem 0;
        gap: 0.75rem;
      }
      .job-card:hover {
        margin: 0 -1rem;
        padding: 1rem;
      }
      .company-avatar { width: 32px; height: 32px; font-size: 0.7rem; border-radius: 8px; }
      .job-source, .job-arrow { display: none; }
      .filters-sidebar { flex-direction: column; gap: 1.5rem; }
      .filter-box { min-width: 0; }
    }
  </style>
</head>
<body>

<!-- ── Navbar ───────────────────────────────────────── -->
<nav class="navbar">
  <a href="#" class="navbar-brand" id="brand-home">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>
    JobPulse
  </a>
  <div class="navbar-right">
    <select class="currency-select" id="currency-select">
      <option value="USD">$ USD</option>
      <option value="EUR">€ EUR</option>
      <option value="GBP">£ GBP</option>
      <option value="CHF">Fr CHF</option>
    </select>
    <div class="navbar-nav">
      <button class="nav-link active" id="nav-jobs">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"/><path d="M16 21V5a2 2 0 00-2-2h-4a2 2 0 00-2 2v16"/></svg>
        <span>Jobs</span>
      </button>
      <button class="nav-link" id="nav-analytics">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>
        <span>Analytics</span>
      </button>
    </div>
  </div>
</nav>

<!-- ── Jobs View ────────────────────────────────────── -->
<div class="view active" id="jobs-view">

<!-- ── Search Hero ──────────────────────────────────── -->
<section class="hero">
  <div class="hero-shapes">
    <div class="hero-orb"></div>
    <div class="hero-orb"></div>
    <div class="hero-orb"></div>
  </div>
  <div class="hero-badges">
    <span class="hero-badge">Software Engineer</span>
    <span class="hero-badge">Product Manager</span>
    <span class="hero-badge">Data Scientist</span>
    <span class="hero-badge">UX Designer</span>
    <span class="hero-badge">DevOps Engineer</span>
    <span class="hero-badge">Frontend Developer</span>
  </div>
  <div class="hero-inner">
    <p class="hero-eyebrow"><span class="dot"></span> <span id="hero-total">—</span> jobs from 5 sources</p>
    <h1>Tech jobs, all in one place</h1>
    <p class="hero-subtitle">Search thousands of remote and on-site positions from top tech companies</p>
    <div class="hero-search">
      <div class="autocomplete-wrap">
        <input class="filter-input" type="text" id="filter-role" placeholder="Filter by title or keyword..." autocomplete="off" />
        <div class="autocomplete-list" id="role-suggestions"></div>
      </div>
      <div class="autocomplete-wrap">
        <input class="filter-input" type="text" id="filter-location" placeholder="Location (e.g. Germany, France)" autocomplete="off" />
        <div class="autocomplete-list" id="location-suggestions"></div>
      </div>
      <button id="filter-btn" class="btn btn-accent">Filter</button>
    </div>
    <div class="hero-work-type">
      <button class="work-type-btn active" data-type="all">All</button>
      <button class="work-type-btn" data-type="remote">Remote</button>
      <button class="work-type-btn" data-type="hybrid">Hybrid</button>
      <button class="work-type-btn" data-type="onsite">On-site</button>
    </div>
    <p class="hero-browse">or <a href="#listings" id="browse-link">browse all listings</a> below</p>
  </div>
</section>

<!-- ── Main Layout ──────────────────────────────────── -->
<div class="main-layout">

  <!-- ── Filters Sidebar ──────────────────────────── -->
  <aside class="filters-sidebar">
    <div class="filter-box">
      <span class="filter-box-label">Seniority Level</span>
      <div class="checkbox-group" id="seniority-chips">
        <label class="chip"><input type="checkbox" value="senior">Senior</label>
        <label class="chip"><input type="checkbox" value="mid">Mid-Level</label>
        <label class="chip"><input type="checkbox" value="junior">Junior</label>
        <label class="chip"><input type="checkbox" value="lead">Lead</label>
        <label class="chip"><input type="checkbox" value="manager">Manager</label>
        <label class="chip"><input type="checkbox" value="director">Director</label>
        <label class="chip"><input type="checkbox" value="staff">Staff</label>
        <label class="chip"><input type="checkbox" value="principal">Principal</label>
      </div>
    </div>

    <div class="filter-box">
      <span class="filter-box-label">Role Category</span>
      <div class="checkbox-group" id="role-chips">
        <label class="chip"><input type="checkbox" value="engineer,developer,software">Engineering</label>
        <label class="chip"><input type="checkbox" value="data,analytics,scientist">Data</label>
        <label class="chip"><input type="checkbox" value="product">Product</label>
        <label class="chip"><input type="checkbox" value="design,ux,ui">Design</label>
        <label class="chip"><input type="checkbox" value="marketing">Marketing</label>
        <label class="chip"><input type="checkbox" value="sales,business,account">Sales</label>
        <label class="chip"><input type="checkbox" value="hr,recruiting,people,talent">HR</label>
        <label class="chip"><input type="checkbox" value="support,customer,success">Support</label>
        <label class="chip"><input type="checkbox" value="operations,ops">Ops</label>
        <label class="chip"><input type="checkbox" value="devops,sre,infrastructure,cloud">DevOps</label>
        <label class="chip"><input type="checkbox" value="security">Security</label>
        <label class="chip"><input type="checkbox" value="ai,ml,machine learning">AI/ML</label>
      </div>
    </div>

    <div class="filter-box">
      <span class="filter-box-label">Work Arrangement</span>
      <div class="checkbox-group" id="worktype-chips">
        <label class="chip"><input type="checkbox" value="remote">Remote</label>
        <label class="chip"><input type="checkbox" value="hybrid">Hybrid</label>
        <label class="chip"><input type="checkbox" value="onsite">On-site</label>
      </div>
    </div>

    <div class="filter-box">
      <span class="filter-box-label">Minimum Salary</span>
      <div class="sidebar-salary">
        <input class="filter-input" type="number" id="filter-salary" placeholder="e.g. 80000" />
      </div>
    </div>

    <div class="filter-box sidebar-source">
      <span class="filter-box-label">Source</span>
      <select class="filter-input" id="filter-source">
        <option value="">All Sources</option>
        <option value="remoteok">RemoteOK</option>
        <option value="arbeitnow">Arbeitnow</option>
        <option value="jobicy">Jobicy</option>
        <option value="weworkremotely">We Work Remotely</option>
        <option value="adzuna">Adzuna</option>
      </select>
    </div>

    <button id="clear-btn" class="btn-clear-filters">Clear All Filters</button>
  </aside>

  <!-- ── Job Listings ─────────────────────────────── -->
  <main class="listings-main" id="listings">
    <!-- Alert Banner -->
    <div class="alert-banner" id="alert-banner">
      <div class="alert-banner-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
      </div>
      <div class="alert-banner-content">
        <p class="alert-banner-title">Get notified about new jobs</p>
        <p class="alert-banner-desc">We'll email you when new jobs match your current search</p>
      </div>
      <div class="alert-banner-form">
        <input type="email" id="alert-email" class="alert-email-input" placeholder="Enter your email" />
        <button id="create-alert-btn" class="btn-alert-submit">Create Alert</button>
      </div>
      <button class="alert-banner-close" id="close-alert-banner">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
      </button>
    </div>

    <section class="card table-section">
      <div class="card-header">
        <div class="listing-tabs">
          <button class="listing-tab active" id="tab-all">All Jobs</button>
          <button class="listing-tab" id="tab-saved">Saved <span class="saved-count">(0)</span></button>
        </div>
        <span class="card-badge" id="results-count">—</span>
      </div>
      <div class="jobs-header">
        <span></span>
        <span>Position</span>
        <span>Location</span>
        <span>Skills</span>
        <span>
          <span class="col-filter" id="salary-filter" title="Click to filter by salary">
            Salary
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 4h13M3 8h9m-9 4h6m4 0l4 4m0 0l4-4m-4 4V4"/></svg>
          </span>
        </span>
        <span>Source</span>
        <span></span>
      </div>
      <div class="jobs-list" id="jobs-list">
        <div class="skeleton-loading">
          <div class="skeleton-card"><div class="skeleton skeleton-bookmark"></div><div class="skeleton-content"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-subtitle"></div></div><div class="skeleton skeleton-location"></div><div class="skeleton skeleton-salary"></div></div>
          <div class="skeleton-card"><div class="skeleton skeleton-bookmark"></div><div class="skeleton-content"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-subtitle"></div></div><div class="skeleton skeleton-location"></div><div class="skeleton skeleton-salary"></div></div>
          <div class="skeleton-card"><div class="skeleton skeleton-bookmark"></div><div class="skeleton-content"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-subtitle"></div></div><div class="skeleton skeleton-location"></div><div class="skeleton skeleton-salary"></div></div>
          <div class="skeleton-card"><div class="skeleton skeleton-bookmark"></div><div class="skeleton-content"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-subtitle"></div></div><div class="skeleton skeleton-location"></div><div class="skeleton skeleton-salary"></div></div>
          <div class="skeleton-card"><div class="skeleton skeleton-bookmark"></div><div class="skeleton-content"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-subtitle"></div></div><div class="skeleton skeleton-location"></div><div class="skeleton skeleton-salary"></div></div>
        </div>
      </div>
      <div class="pagination">
        <button id="prev-page" class="btn btn-ghost btn-sm" disabled>&larr; Previous</button>
        <span id="page-info">Page 1</span>
        <button id="next-page" class="btn btn-ghost btn-sm">Next &rarr;</button>
      </div>
    </section>
  </main>

</div>

</div><!-- /jobs-view -->

<!-- ── Analytics View ───────────────────────────────── -->
<div class="view" id="analytics-view">
  <div class="analytics-view">
    <div class="analytics-header">
      <h2>Market Analytics</h2>
      <p>Insights from aggregated job listings across all sources</p>
    </div>
    <!-- Insight Row: Sources Doughnut + Top Tags + Top Companies -->
    <section class="insight-grid">
      <div class="card reveal-scale" style="transition-delay: 0s;">
        <div class="card-header">
          <span class="card-title">Sources Breakdown</span>
          <span class="card-badge live-badge">Live</span>
        </div>
        <div class="doughnut-wrap">
          <canvas id="sources-doughnut"></canvas>
        </div>
      </div>
      <div class="card reveal-scale" style="transition-delay: 0.1s;">
        <div class="card-header">
          <span class="card-title">Top Skills</span>
          <span class="card-badge">By frequency</span>
        </div>
        <ul class="insight-list" id="top-tags-list"></ul>
      </div>
      <div class="card reveal-scale" style="transition-delay: 0.2s;">
        <div class="card-header">
          <span class="card-title">Top Companies</span>
          <span class="card-badge">Most listings</span>
        </div>
        <ul class="insight-list" id="top-companies-list"></ul>
      </div>
    </section>

    <!-- Charts -->
    <section class="charts-grid">
      <div class="card chart-card reveal" style="transition-delay: 0.3s;">
        <div class="card-header">
          <span class="card-title">Salary Distribution</span>
          <span class="card-badge">USD equivalent</span>
        </div>
        <canvas id="salary-chart"></canvas>
      </div>
      <div class="card chart-card reveal" style="transition-delay: 0.4s;">
        <div class="card-header">
          <span class="card-title">Scrape History</span>
          <span class="card-badge">Added vs Removed</span>
        </div>
        <canvas id="history-chart"></canvas>
      </div>
    </section>
  </div>
</div><!-- /analytics-view -->

<footer>
  <p>JobPulse &mdash; Resilient data pipeline demo &mdash; <a href="https://github.com/AntoineKoerber/JobPulse">View Source &amp; Architecture</a></p>
  <div class="footer-tech">
    <span>Python</span>
    <span>FastAPI</span>
    <span>Supabase</span>
    <span>Chart.js</span>
    <span>Playwright</span>
  </div>
</footer>

<script>
(() => {
  'use strict';

  const SB = 'https://rbwfnhnuvedrljlawisq.supabase.co';
  const KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJid2ZuaG51dmVkcmxqbGF3aXNxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk4MzIwMzgsImV4cCI6MjA4NTQwODAzOH0.wSCGwvtKp-t8FJB6NsCKdwnJJFzHUIldAzMLxgvxL_c';
  const H = { 'apikey': KEY, 'Authorization': `Bearer ${KEY}` };

  const q = (t, p = '') => fetch(`${SB}/rest/v1/${t}?${p}`, { headers: H });

  // ── Supabase Client ─────────────────────────────
  const supabase = window.supabase.createClient(SB, KEY);
  let currentUserId = null;

  let page = 1;
  const PAGE_SIZE = 50;
  let salaryChart, historyChart, doughnutChart;
  let allLocations = [];
  let allRoles = [];
  let salaryFilter = 'all'; // 'all', 'has', 'none'
  let viewMode = 'all'; // 'all' | 'saved'
  let heroWorkType = 'all'; // 'all', 'remote', 'hybrid', 'onsite'
  let analyticsLoaded = false;

  // ── Saved / Bookmark helpers (Supabase) ─────────
  let savedIds = new Set();

  async function initAuth() {
    // Check for existing session
    const { data: { session } } = await supabase.auth.getSession();
    if (session?.user) {
      currentUserId = session.user.id;
    } else {
      // Create anonymous session
      const { data, error } = await supabase.auth.signInAnonymously();
      if (error) {
        console.error('Anonymous auth failed:', error);
        return;
      }
      currentUserId = data.user.id;
    }
    await loadSavedIds();
  }

  async function loadSavedIds() {
    if (!currentUserId) return;
    const { data, error } = await supabase
      .from('saved_jobs')
      .select('job_id')
      .eq('user_id', currentUserId);
    if (error) {
      console.error('Failed to load saved jobs:', error);
      return;
    }
    savedIds = new Set(data.map(r => r.job_id));
    updateSavedCount();
  }

  function isSaved(id) { return savedIds.has(id); }

  async function toggleSaved(id) {
    if (!currentUserId) return;
    if (savedIds.has(id)) {
      // Remove from saved
      const { error } = await supabase
        .from('saved_jobs')
        .delete()
        .eq('user_id', currentUserId)
        .eq('job_id', id);
      if (!error) savedIds.delete(id);
    } else {
      // Add to saved
      const { error } = await supabase
        .from('saved_jobs')
        .insert({ user_id: currentUserId, job_id: id });
      if (!error) savedIds.add(id);
    }
    updateSavedCount();
  }

  function updateSavedCount() {
    const el = document.querySelector('#tab-saved .saved-count');
    if (el) el.textContent = `(${savedIds.size})`;
  }

  // ── Decode HTML entities ─────────────────────
  function decodeHtml(s) {
    if (!s) return '';
    const txt = document.createElement('textarea');
    txt.innerHTML = s;
    return txt.value;
  }

  // ── Autocomplete ─────────────────────────────
  async function loadSuggestions() {
    try {
      const res = await q('job_listings', 'is_active=eq.true&select=location,title');
      const data = await res.json();

      // Unique locations - parse and extract individual places
      const locCounts = {};
      data.forEach(d => {
        if (!d.location || d.location.length < 2) return;
        // Split by common delimiters to get individual locations
        const parts = d.location.split(/[,\/;]|\s+or\s+|\s+-\s+/i);
        parts.forEach(part => {
          const loc = part.trim();
          // Filter out generic terms and very short strings
          if (loc.length > 2 &&
              !loc.toLowerCase().match(/^(remote|worldwide|anywhere|global|hybrid|on-?site|full-?time|part-?time|n\/a|other)$/i)) {
            locCounts[loc] = (locCounts[loc] || 0) + 1;
          }
        });
      });
      // Sort by frequency (most common first) then alphabetically
      allLocations = Object.entries(locCounts)
        .sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]))
        .map(([loc]) => loc);

      // Common role keywords from titles
      const roleWords = {};
      const rolePatterns = ['engineer', 'developer', 'manager', 'designer', 'analyst', 'director', 'lead', 'senior', 'junior', 'architect', 'consultant', 'specialist', 'coordinator', 'associate', 'assistant', 'intern', 'head', 'vp', 'chief', 'officer', 'admin', 'support', 'sales', 'marketing', 'product', 'project', 'data', 'software', 'frontend', 'backend', 'fullstack', 'devops', 'cloud', 'security', 'qa', 'test', 'mobile', 'ios', 'android', 'web', 'ui', 'ux', 'hr', 'finance', 'operations', 'customer', 'success', 'account', 'business', 'content', 'writer', 'editor'];
      data.forEach(d => {
        const words = (d.title || '').toLowerCase().split(/\s+/);
        words.forEach(w => {
          if (rolePatterns.some(p => w.includes(p)) && w.length > 2) {
            roleWords[w] = (roleWords[w] || 0) + 1;
          }
        });
      });
      allRoles = Object.entries(roleWords).filter(([k, v]) => v >= 3).sort((a, b) => b[1] - a[1]).map(([k]) => k);
    } catch (e) { console.error('Failed to load suggestions', e); }
  }

  function setupAutocomplete(inputId, listId, getSuggestions, supportMultiple = false) {
    const input = document.getElementById(inputId);
    const list = document.getElementById(listId);
    let activeIdx = -1;

    // Helper to get current search term (last part after comma if multiple)
    function getCurrentTerm() {
      const fullVal = input.value;
      if (supportMultiple && fullVal.includes(',')) {
        const parts = fullVal.split(',');
        return parts[parts.length - 1].trim().toLowerCase();
      }
      return fullVal.toLowerCase().trim();
    }

    // Helper to set value (append or replace)
    function setValue(selected) {
      const fullVal = input.value;
      if (supportMultiple && fullVal.includes(',')) {
        const parts = fullVal.split(',');
        parts[parts.length - 1] = ' ' + selected;
        input.value = parts.join(',');
      } else {
        input.value = selected;
      }
    }

    input.addEventListener('input', () => {
      const val = getCurrentTerm();
      if (val.length < 1) { list.classList.remove('show'); return; }

      // Filter out already-selected items
      const alreadySelected = supportMultiple ?
        input.value.split(',').map(p => p.trim().toLowerCase()).filter(p => p) : [];

      const matches = getSuggestions()
        .filter(s => s.toLowerCase().includes(val) && !alreadySelected.includes(s.toLowerCase()))
        .slice(0, 8);
      if (!matches.length) { list.classList.remove('show'); return; }

      list.innerHTML = matches.map(m => {
        const formatted = titleCase(m);
        const idx = formatted.toLowerCase().indexOf(val);
        const highlighted = formatted.slice(0, idx) + '<mark>' + formatted.slice(idx, idx + val.length) + '</mark>' + formatted.slice(idx + val.length);
        return `<div class="autocomplete-item">${highlighted}</div>`;
      }).join('');
      list.classList.add('show');
      activeIdx = -1;

      list.querySelectorAll('.autocomplete-item').forEach((item, i) => {
        item.addEventListener('click', () => {
          setValue(matches[i]);
          list.classList.remove('show');
          page = 1;
          loadJobs();
        });
      });
    });

    input.addEventListener('keydown', e => {
      const items = list.querySelectorAll('.autocomplete-item');
      if (!list.classList.contains('show') || !items.length) return;

      if (e.key === 'ArrowDown') {
        e.preventDefault();
        activeIdx = Math.min(activeIdx + 1, items.length - 1);
        items.forEach((it, i) => it.classList.toggle('active', i === activeIdx));
      } else if (e.key === 'ArrowUp') {
        e.preventDefault();
        activeIdx = Math.max(activeIdx - 1, 0);
        items.forEach((it, i) => it.classList.toggle('active', i === activeIdx));
      } else if (e.key === 'Enter' && activeIdx >= 0) {
        e.preventDefault();
        setValue(items[activeIdx].textContent);
        list.classList.remove('show');
        page = 1;
        loadJobs();
      } else if (e.key === 'Escape') {
        list.classList.remove('show');
      }
    });

    input.addEventListener('blur', () => { setTimeout(() => list.classList.remove('show'), 150); });
  }

  // ── Chip toggle ─────────────────────────────
  document.querySelectorAll('.chip').forEach(chip => {
    const input = chip.querySelector('input');
    input.addEventListener('change', () => {
      chip.classList.toggle('active', input.checked);
      page = 1;
      loadJobs();
    });
  });

  // ── Enter on filters ──────────────────────────
  document.querySelectorAll('.filter-input').forEach(el => {
    el.addEventListener('keydown', e => { if (e.key === 'Enter') { page = 1; loadJobs(); } });
  });
  document.getElementById('filter-btn').addEventListener('click', () => { page = 1; loadJobs(); });
  // Clear all filters
  function clearAllFilters() {
    document.getElementById('filter-role').value = '';
    document.getElementById('filter-location').value = '';
    document.getElementById('filter-salary').value = '';
    document.getElementById('filter-source').value = '';
    document.querySelectorAll('.chip').forEach(c => { c.classList.remove('active'); c.querySelector('input').checked = false; });
    salaryFilter = 'all';
    document.getElementById('salary-filter').classList.remove('active');
    document.getElementById('salary-filter').title = 'Click to show only jobs with salary';
    page = 1;
    viewMode = 'all';
    document.getElementById('tab-all').classList.add('active');
    document.getElementById('tab-saved').classList.remove('active');
    loadJobs();
  }

  document.getElementById('clear-btn').addEventListener('click', clearAllFilters);

  // Logo/brand click - reset to home state
  document.getElementById('brand-home').addEventListener('click', (e) => {
    e.preventDefault();
    // Switch to jobs view if on analytics
    document.getElementById('nav-jobs').classList.add('active');
    document.getElementById('nav-analytics').classList.remove('active');
    document.getElementById('jobs-view').classList.add('active');
    document.getElementById('analytics-view').classList.remove('active');
    // Clear all filters
    clearAllFilters();
    // Scroll to top
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });

  // ── Tab click handlers ──────────────────────
  document.getElementById('tab-all').addEventListener('click', () => {
    viewMode = 'all';
    document.getElementById('tab-all').classList.add('active');
    document.getElementById('tab-saved').classList.remove('active');
    page = 1;
    loadJobs();
  });
  document.getElementById('tab-saved').addEventListener('click', () => {
    viewMode = 'saved';
    document.getElementById('tab-saved').classList.add('active');
    document.getElementById('tab-all').classList.remove('active');
    page = 1;
    loadJobs();
  });

  // ── Browse link smooth scroll ────────────────────
  document.getElementById('browse-link').addEventListener('click', (e) => {
    e.preventDefault();
    document.getElementById('listings').scrollIntoView({ behavior: 'smooth', block: 'start' });
  });

  // ── Navigation handlers ────────────────────────
  document.getElementById('nav-jobs').addEventListener('click', () => {
    document.getElementById('nav-jobs').classList.add('active');
    document.getElementById('nav-analytics').classList.remove('active');
    document.getElementById('jobs-view').classList.add('active');
    document.getElementById('analytics-view').classList.remove('active');
  });

  document.getElementById('nav-analytics').addEventListener('click', () => {
    document.getElementById('nav-analytics').classList.add('active');
    document.getElementById('nav-jobs').classList.remove('active');
    document.getElementById('analytics-view').classList.add('active');
    document.getElementById('jobs-view').classList.remove('active');
    // Lazy load analytics on first view
    if (!analyticsLoaded) {
      loadInsights();
      analyticsLoaded = true;
    }
  });

  // ── Bookmark click delegation ─────────────────
  document.getElementById('jobs-list').addEventListener('click', async (e) => {
    const btn = e.target.closest('.bookmark-btn');
    if (!btn) return;
    e.preventDefault();
    e.stopPropagation();
    const id = Number(btn.dataset.id);
    const wasSaved = isSaved(id);
    // Optimistic UI update
    btn.classList.toggle('saved');
    btn.title = wasSaved ? 'Save this job' : 'Remove from saved';
    // Pulse animation
    btn.classList.remove('pulse-anim');
    void btn.offsetWidth; // reflow to restart animation
    btn.classList.add('pulse-anim');
    // Persist to Supabase
    await toggleSaved(id);
    // If in saved view and we just unsaved, reload to remove from list
    if (viewMode === 'saved' && wasSaved) {
      loadJobs();
    }
  });

  // Salary column filter (cycles: all -> has -> none -> all)
  document.getElementById('salary-filter').addEventListener('click', () => {
    const el = document.getElementById('salary-filter');
    if (salaryFilter === 'all') {
      salaryFilter = 'has';
      el.classList.add('active');
      el.innerHTML = 'With Salary <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>';
      el.title = 'Showing jobs with salary. Click to show jobs without salary.';
    } else if (salaryFilter === 'has') {
      salaryFilter = 'none';
      el.innerHTML = 'No Salary <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>';
      el.title = 'Showing jobs without salary. Click to show all jobs.';
    } else {
      salaryFilter = 'all';
      el.classList.remove('active');
      el.innerHTML = 'Salary <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 4h13M3 8h9m-9 4h6m4 0l4 4m0 0l4-4m-4 4V4"/></svg>';
      el.title = 'Click to show only jobs with salary';
    }
    page = 1;
    loadJobs();
  });
  document.getElementById('prev-page').addEventListener('click', () => { if (page > 1) { page--; loadJobs(); } });
  document.getElementById('next-page').addEventListener('click', () => { page++; loadJobs(); });

  // ── Get selected chips ───────────────────────
  function getSelectedChips(containerId) {
    const chips = document.querySelectorAll(`#${containerId} .chip.active input`);
    const values = [];
    chips.forEach(c => values.push(...c.value.split(',')));
    return values;
  }

  // ── Jobs Table ────────────────────────────────
  async function loadJobs() {
    const role = document.getElementById('filter-role').value.trim();
    const loc = document.getElementById('filter-location').value.trim();
    const sal = document.getElementById('filter-salary').value;
    const src = document.getElementById('filter-source').value;
    const seniority = getSelectedChips('seniority-chips');
    const roleTypes = getSelectedChips('role-chips');
    const workTypes = getSelectedChips('worktype-chips');

    // Saved view: short-circuit if nothing saved
    if (viewMode === 'saved' && savedIds.size === 0) {
      document.getElementById('jobs-list').innerHTML = '<div class="no-results">No saved jobs yet — click the bookmark icon to save listings</div>';
      updatePag(0, 1);
      document.getElementById('results-count').textContent = '0 results';
      return;
    }

    let f = 'is_active=eq.true&order=last_seen.desc';
    if (viewMode === 'saved') {
      f += `&id=in.(${[...savedIds].join(',')})`;
    }
    if (src) f += `&source=eq.${src}`;
    // Parse locations (used for filtering and priority sorting)
    const locations = loc ? loc.split(',').map(l => l.trim()).filter(l => l.length > 0) : [];
    if (locations.length === 1) {
      f += `&location=ilike.*${encodeURIComponent(locations[0])}*`;
    } else if (locations.length > 1) {
      // OR query for multiple locations
      const locOr = locations.map(l => `location.ilike.*${encodeURIComponent(l)}*`).join(',');
      f += `&or=(${locOr})`;
    }
    if (role) f += `&or=(title.ilike.*${encodeURIComponent(role)}*,tags.cs.["${role}"])`;
    if (sal) f += `&salary_min=gte.${sal}`;

    // Seniority filter (OR within group)
    if (seniority.length) {
      const seniorityOr = seniority.map(s => `title.ilike.*${s}*`).join(',');
      f += `&or=(${seniorityOr})`;
    }

    // Role type filter (OR within group)
    if (roleTypes.length) {
      const roleOr = roleTypes.map(r => `title.ilike.*${encodeURIComponent(r)}*`).join(',');
      f += `&or=(${roleOr})`;
    }

    // Work type filter (from sidebar or hero buttons)
    const effectiveWorkType = workTypes.length > 0 ? workTypes : (heroWorkType !== 'all' ? [heroWorkType] : []);
    if (effectiveWorkType.length === 1) {
      if (effectiveWorkType[0] === 'remote') {
        f += '&or=(source.in.(remoteok,jobicy,weworkremotely),location.ilike.*remote*)';
      } else if (effectiveWorkType[0] === 'hybrid') {
        f += '&location=ilike.*hybrid*';
      } else if (effectiveWorkType[0] === 'onsite') {
        f += '&source=eq.arbeitnow&not.location=ilike.*remote*';
      }
    } else if (effectiveWorkType.length > 1) {
      // Multiple work types - build OR conditions
      const wtConds = [];
      if (effectiveWorkType.includes('remote')) wtConds.push('source.in.(remoteok,jobicy)', 'location.ilike.*remote*');
      if (effectiveWorkType.includes('hybrid')) wtConds.push('location.ilike.*hybrid*');
      if (effectiveWorkType.includes('onsite')) wtConds.push('and(source.eq.arbeitnow,not.location.ilike.*remote*)');
      if (wtConds.length) f += `&or=(${wtConds.join(',')})`;
    }

    // Salary info filter (from column header)
    if (salaryFilter === 'has') {
      f += '&or=(salary_min.not.is.null,salary_max.not.is.null)';
    } else if (salaryFilter === 'none') {
      f += '&salary_min=is.null&salary_max=is.null';
    }

    const off = (page - 1) * PAGE_SIZE;
    try {
      const res = await fetch(
        `${SB}/rest/v1/job_listings?${f}&select=id,external_id,source,title,company,location,salary_min,salary_max,currency,tags,url`,
        { headers: { ...H, 'Prefer': 'count=exact', 'Range': `${off}-${off + PAGE_SIZE - 1}` } }
      );
      let data = await res.json();
      const total = parseInt(res.headers.get('content-range')?.split('/')[1] || '0');
      // Sort by location priority (first entered location appears first)
      if (locations.length > 1) {
        data.sort((a, b) => {
          const aLoc = (a.location || '').toLowerCase();
          const bLoc = (b.location || '').toLowerCase();
          const aIdx = locations.findIndex(l => aLoc.toLowerCase().includes(l.toLowerCase()));
          const bIdx = locations.findIndex(l => bLoc.toLowerCase().includes(l.toLowerCase()));
          const aPriority = aIdx === -1 ? locations.length : aIdx;
          const bPriority = bIdx === -1 ? locations.length : bIdx;
          return aPriority - bPriority;
        });
      }
      renderTable(data);
      updatePag(total, page);
      // Update hero stats with animation
      if (viewMode === 'all' && !role && !loc && !sal && !src && !seniority.length && !roleTypes.length && !workTypes.length && salaryFilter === 'all') {
        const heroTotal = document.getElementById('hero-total');
        const currentVal = parseInt(heroTotal.textContent.replace(/,/g, '')) || 0;
        if (currentVal !== total && total > 0) {
          animateCounter(heroTotal, total);
        }
      }
      document.getElementById('results-count').textContent = `${total.toLocaleString()} results`;
    } catch (e) { console.error(e); }
  }

  function renderTable(jobs) {
    const list = document.getElementById('jobs-list');
    if (!jobs.length) {
      list.innerHTML = '<div class="no-results">No listings match your filters</div>';
      return;
    }
    list.innerHTML = jobs.map(j => {
      const sal = fmtSal(j.salary_min, j.salary_max, j.currency);
      const title = esc(titleCase(decodeHtml(j.title)));
      const company = esc(titleCase(decodeHtml(j.company)));
      const rawLoc = decodeHtml(j.location) || '';
      const loc = esc(titleCase(rawLoc) || '—');
      const hasSalary = j.salary_min || j.salary_max;
      const tags = (j.tags || []).slice(0, 2).map(t => `<span class="tag">${esc(fmtTag(decodeHtml(t)))}</span>`).join('');
      const url = j.url || '#';
      const workType = getWorkType(rawLoc, j.source, j.tags);

      const saved = isSaved(j.id);
      const avatar = getCompanyAvatar(j.company);
      return `<a href="${url}" target="_blank" rel="noopener" class="job-card">
        <button class="bookmark-btn${saved ? ' saved' : ''}" data-id="${j.id}" title="${saved ? 'Remove from saved' : 'Save this job'}">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21l-7-5-7 5V5a2 2 0 012-2h10a2 2 0 012 2z"/></svg>
        </button>
        <div class="company-avatar" style="background:${avatar.bg};color:${avatar.fg}">${avatar.initials}</div>
        <div class="job-main">
          <div class="job-title">${title}</div>
          <span class="job-company">${company}</span>
        </div>
        <div class="job-location">
          <span class="job-location-text">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/><circle cx="12" cy="10" r="3"/></svg>
            ${loc}
          </span>
          ${workTypeBadge(workType)}
        </div>
        <div class="job-tags">${tags || '<span class="tag" style="opacity:0.3">—</span>'}</div>
        <span class="job-salary${hasSalary ? '' : ' none'}">${sal}</span>
        <span class="job-source ${j.source}">${fmtSource(j.source)}</span>
        <div class="job-arrow">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
        </div>
      </a>`;
    }).join('');
  }

  function updatePag(total, p) {
    const mx = Math.max(1, Math.ceil(total / PAGE_SIZE));
    document.getElementById('page-info').textContent = `Page ${p} of ${mx}`;
    document.getElementById('prev-page').disabled = p <= 1;
    document.getElementById('next-page').disabled = p >= mx;
  }

  // Currency conversion rates (approximate, relative to USD)
  const exchangeRates = {
    USD: 1,
    EUR: 0.92,
    GBP: 0.79,
    CHF: 0.88
  };
  const currencySymbols = { USD: '$', EUR: '€', GBP: '£', CHF: 'Fr' };
  let displayCurrency = 'USD';

  function convertCurrency(amount, fromCurrency, toCurrency) {
    if (!amount || fromCurrency === toCurrency) return amount;
    // Convert to USD first, then to target
    const inUSD = amount / (exchangeRates[fromCurrency] || 1);
    return Math.round(inUSD * (exchangeRates[toCurrency] || 1));
  }

  function fmtSal(mn, mx, cur) {
    if (!mn && !mx) return '—';
    // Convert to display currency
    const convertedMn = mn ? convertCurrency(mn, cur || 'USD', displayCurrency) : null;
    const convertedMx = mx ? convertCurrency(mx, cur || 'USD', displayCurrency) : null;
    const f = n => `${(n / 1000).toFixed(0)}k`;
    const s = currencySymbols[displayCurrency] || '$';
    if (convertedMn && convertedMx && convertedMn !== convertedMx) return `${s}${f(convertedMn)} – ${s}${f(convertedMx)}`;
    return `${s}${f(convertedMn || convertedMx)}`;
  }

  function esc(s) { if (!s) return ''; const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }

  function titleCase(s) {
    if (!s) return '';
    const minor = new Set(['a','an','the','and','or','but','in','on','at','to','for','of','with','by','from','as']);
    return s.split(' ').map((w, i) => {
      const lo = w.toLowerCase();
      if (i > 0 && minor.has(lo)) return lo;
      if (w === w.toUpperCase() && w.length <= 5) return w; // keep acronyms like "AI", "AWS"
      return lo.charAt(0).toUpperCase() + lo.slice(1);
    }).join(' ');
  }

  function fmtTag(t) {
    if (!t) return '';
    const up = t.trim();
    // Keep short acronyms uppercase
    if (up.length <= 4 && up === up.toUpperCase()) return up;
    return up.charAt(0).toUpperCase() + up.slice(1);
  }

  function fmtSource(s) {
    const map = {
      remoteok: 'RemoteOK',
      arbeitnow: 'Arbeitnow',
      jobicy: 'Jobicy',
      weworkremotely: 'WWR',
      adzuna: 'Adzuna'
    };
    return map[s] || s;
  }

  function getCompanyAvatar(company) {
    // Generate initials (up to 2 characters)
    const words = (company || '').trim().split(/\s+/).filter(w => w.length > 0);
    let initials;
    if (words.length === 0) {
      initials = '?';
    } else if (words.length === 1) {
      initials = words[0].substring(0, 2).toUpperCase();
    } else {
      initials = (words[0][0] + words[1][0]).toUpperCase();
    }

    // Generate consistent color based on company name
    const colors = [
      { bg: '#dbeafe', fg: '#1d4ed8' }, // blue
      { bg: '#dcfce7', fg: '#15803d' }, // green
      { bg: '#fef3c7', fg: '#b45309' }, // amber
      { bg: '#fce7f3', fg: '#be185d' }, // pink
      { bg: '#e0e7ff', fg: '#4338ca' }, // indigo
      { bg: '#ffedd5', fg: '#c2410c' }, // orange
      { bg: '#f3e8ff', fg: '#7c3aed' }, // violet
      { bg: '#ccfbf1', fg: '#0f766e' }, // teal
    ];
    let hash = 0;
    for (let i = 0; i < (company || '').length; i++) {
      hash = ((hash << 5) - hash) + company.charCodeAt(i);
    }
    const color = colors[Math.abs(hash) % colors.length];

    return { initials, bg: color.bg, fg: color.fg };
  }

  function getWorkType(location, source, tags) {
    const loc = (location || '').toLowerCase();
    const allTags = (tags || []).map(t => t.toLowerCase()).join(' ');
    const combined = loc + ' ' + allTags;

    // RemoteOK, Jobicy, and WeWorkRemotely are remote-first boards
    if (source === 'remoteok' || source === 'jobicy' || source === 'weworkremotely') return 'remote';

    // Check for hybrid indicators
    if (combined.includes('hybrid')) return 'hybrid';

    // Check for remote indicators
    if (combined.includes('remote') || combined.includes('worldwide') || combined.includes('anywhere')) return 'remote';

    // Check for on-site indicators
    if (combined.includes('on-site') || combined.includes('onsite') || combined.includes('in-office')) return 'onsite';

    // Default: if has specific city/country, likely on-site
    if (loc && !loc.includes('remote') && loc.length > 2) return 'onsite';

    return 'remote'; // Default for job boards
  }

  function workTypeBadge(type) {
    const icons = {
      remote: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>',
      hybrid: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>',
      onsite: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>'
    };
    const labels = { remote: 'Remote', hybrid: 'Hybrid', onsite: 'On-site' };
    return `<span class="work-type ${type}">${icons[type]}${labels[type]}</span>`;
  }

  // ── Insights (Lazy loaded) ──────────────────────────────────
  async function loadInsights() {
    try {
      const res = await q('job_listings', 'is_active=eq.true&select=tags,salary_min,salary_max,company,source');
      const all = await res.json();

      // Sources breakdown doughnut
      const srcCounts = {};
      all.forEach(l => { srcCounts[l.source] = (srcCounts[l.source] || 0) + 1; });
      renderDoughnut(srcCounts);

      // Companies
      const compCounts = {};
      all.forEach(l => { compCounts[l.company] = (compCounts[l.company] || 0) + 1; });
      const topComp = Object.entries(compCounts).sort((a, b) => b[1] - a[1]).slice(0, 8);
      renderList('top-companies-list', topComp);

      // Tags — filter out generic/location terms that aren't skills
      const skipTags = new Set(['remote','remote work','worldwide','anywhere','full-time','part-time','contract','freelance','hybrid','onsite','on-site','other','n/a','intern','internship']);
      const tagCounts = {};
      all.forEach(l => (l.tags || []).forEach(t => { const k = t.toLowerCase().trim(); if (!skipTags.has(k) && k.length > 1) tagCounts[k] = (tagCounts[k] || 0) + 1; }));
      const topTags = Object.entries(tagCounts).sort((a, b) => b[1] - a[1]).slice(0, 8);
      renderList('top-tags-list', topTags);

      // Salary
      const bk = { '0–50k': 0, '50–80k': 0, '80–120k': 0, '120–160k': 0, '160–200k': 0, '200k+': 0 };
      all.forEach(l => {
        const s = l.salary_min || l.salary_max;
        if (!s) return;
        if (s < 50000) bk['0–50k']++;
        else if (s < 80000) bk['50–80k']++;
        else if (s < 120000) bk['80–120k']++;
        else if (s < 160000) bk['120–160k']++;
        else if (s < 200000) bk['160–200k']++;
        else bk['200k+']++;
      });
      renderSalary(bk);

      // Scrape history
      const hRes = await q('scrape_runs', 'status=eq.completed&order=started_at.desc&limit=30&select=source,started_at,quality_score,total_count,added_count,removed_count');
      const hist = await hRes.json();
      renderHistory(hist);
    } catch (e) { console.error(e); }
  }

  function renderList(id, items) {
    const ul = document.getElementById(id);
    const isTags = id.includes('tags');
    ul.innerHTML = items.map(([label, count], i) =>
      `<li><span class="rank">${i + 1}</span><span class="label">${esc(isTags ? fmtTag(label) : titleCase(label))}</span><span class="value">${count}</span></li>`
    ).join('');
  }

  // Chart config (light mode)
  const gridColor = 'rgba(0,0,0,0.06)';
  const tickColor = '#5a5a72';
  const baseOpts = {
    responsive: true, maintainAspectRatio: false,
    plugins: { legend: { display: false } },
    scales: {
      x: { ticks: { color: tickColor, font: { size: 11, family: 'Inter' } }, grid: { color: gridColor } },
      y: { ticks: { color: tickColor, font: { size: 11, family: 'Inter' } }, grid: { color: gridColor } },
    },
  };

  function renderDoughnut(srcCounts) {
    const ctx = document.getElementById('sources-doughnut');
    if (doughnutChart) doughnutChart.destroy();
    const labels = Object.keys(srcCounts).map(fmtSource);
    const colors = ['#6366f1', '#22c55e', '#f97316', '#06b6d4', '#a855f7'];
    doughnutChart = new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels,
        datasets: [{ data: Object.values(srcCounts), backgroundColor: colors.slice(0, labels.length), borderWidth: 0, hoverOffset: 6 }],
      },
      options: {
        responsive: true, maintainAspectRatio: true, cutout: '65%',
        plugins: {
          legend: { display: true, position: 'bottom', labels: { color: tickColor, font: { size: 12, family: 'Inter' }, padding: 12, usePointStyle: true, pointStyleWidth: 8 } },
        },
      },
    });
  }

  function renderSalary(bk) {
    const ctx = document.getElementById('salary-chart');
    if (salaryChart) salaryChart.destroy();
    const gradient = ctx.getContext('2d').createLinearGradient(0, 0, 0, 250);
    gradient.addColorStop(0, 'rgba(34,197,94,0.5)');
    gradient.addColorStop(1, 'rgba(34,197,94,0.05)');
    salaryChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: Object.keys(bk),
        datasets: [{ data: Object.values(bk), backgroundColor: gradient, borderColor: 'rgba(34,197,94,0.6)', borderWidth: 1, borderRadius: 6 }],
      },
      options: baseOpts,
    });
  }

  function renderHistory(hist) {
    const ctx = document.getElementById('history-chart');
    if (historyChart) historyChart.destroy();
    const sorted = [...hist].reverse();
    historyChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: sorted.map(h => new Date(h.started_at).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })),
        datasets: [
          { label: 'Added', data: sorted.map(h => h.added_count), borderColor: '#22c55e', backgroundColor: 'rgba(34,197,94,0.08)', fill: true, tension: 0.4, pointRadius: 3, pointBackgroundColor: '#22c55e' },
          { label: 'Removed', data: sorted.map(h => h.removed_count), borderColor: '#ef4444', backgroundColor: 'rgba(239,68,68,0.08)', fill: true, tension: 0.4, pointRadius: 3, pointBackgroundColor: '#ef4444' },
        ],
      },
      options: { ...baseOpts, plugins: { legend: { display: true, labels: { color: tickColor, font: { size: 12, family: 'Inter' }, usePointStyle: true, pointStyleWidth: 8 } } } },
    });
  }

  // ── Animated Counter ────────────────────────────
  function animateCounter(element, target, duration = 1500) {
    const start = 0;
    const startTime = performance.now();
    const format = (n) => n.toLocaleString();

    function update(currentTime) {
      const elapsed = currentTime - startTime;
      const progress = Math.min(elapsed / duration, 1);
      // Ease out cubic
      const easeOut = 1 - Math.pow(1 - progress, 3);
      const current = Math.floor(start + (target - start) * easeOut);
      element.textContent = format(current);

      if (progress < 1) {
        requestAnimationFrame(update);
      }
    }
    requestAnimationFrame(update);
  }

  // ── Animated Placeholder ───────────────────────
  function animatePlaceholder(input, placeholders, interval = 3000) {
    let index = 0;
    let charIndex = 0;
    let isDeleting = false;
    let currentText = '';
    const typeSpeed = 80;
    const deleteSpeed = 40;
    const pauseDuration = 2000;

    function type() {
      const target = placeholders[index];

      if (!isDeleting) {
        currentText = target.substring(0, charIndex + 1);
        charIndex++;
        input.placeholder = currentText;

        if (charIndex === target.length) {
          setTimeout(() => { isDeleting = true; type(); }, pauseDuration);
          return;
        }
      } else {
        currentText = target.substring(0, charIndex - 1);
        charIndex--;
        input.placeholder = currentText;

        if (charIndex === 0) {
          isDeleting = false;
          index = (index + 1) % placeholders.length;
        }
      }

      setTimeout(type, isDeleting ? deleteSpeed : typeSpeed);
    }

    type();
  }

  // ── Scroll Reveal ──────────────────────────────
  function setupScrollReveal() {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
        }
      });
    }, { threshold: 0.1, rootMargin: '0px 0px -50px 0px' });

    document.querySelectorAll('.reveal, .reveal-left, .reveal-scale').forEach(el => {
      observer.observe(el);
    });
  }

  // ── Magnetic Button Effect ─────────────────────
  function setupMagneticButtons() {
    document.querySelectorAll('.btn-accent').forEach(btn => {
      btn.addEventListener('mousemove', (e) => {
        const rect = btn.getBoundingClientRect();
        const x = e.clientX - rect.left - rect.width / 2;
        const y = e.clientY - rect.top - rect.height / 2;
        btn.style.transform = `translate(${x * 0.15}px, ${y * 0.15}px)`;
      });
      btn.addEventListener('mouseleave', () => {
        btn.style.transform = '';
      });
    });
  }

  // ── Staggered List Animation ───────────────────
  function animateListItems(container) {
    const items = container.querySelectorAll('.job-card, .skeleton-card');
    items.forEach((item, i) => {
      item.style.animationDelay = `${i * 0.03}s`;
    });
  }

  // ── Job Alerts ─────────────────────────────────
  const ALERT_BANNER_KEY = 'jobpulse_alert_banner_hidden';

  function getCurrentFilters() {
    return {
      role: document.getElementById('filter-role').value.trim(),
      location: document.getElementById('filter-location').value.trim(),
      salary: document.getElementById('filter-salary').value,
      source: document.getElementById('filter-source').value,
      seniority: getSelectedChips('seniority-chips'),
      roleTypes: getSelectedChips('role-chips'),
      workTypes: getSelectedChips('worktype-chips')
    };
  }

  function hasActiveFilters() {
    const f = getCurrentFilters();
    return f.role || f.location || f.salary || f.source ||
           f.seniority.length > 0 || f.roleTypes.length > 0 || f.workTypes.length > 0 ||
           (heroWorkType && heroWorkType !== 'all');
  }

  function getFilterDescription() {
    const f = getCurrentFilters();
    const parts = [];
    if (f.role) parts.push(`"${f.role}"`);
    if (f.location) parts.push(`in ${f.location}`);
    if (f.seniority?.length) parts.push(f.seniority.join(', '));
    if (f.roleTypes?.length) parts.push(f.roleTypes.join(', '));
    if (f.workTypes?.length) parts.push(f.workTypes.map(w => w === 'remote' ? 'Remote' : w === 'hybrid' ? 'Hybrid' : 'On-site').join(', '));
    // Include hero work type if not "all"
    if (heroWorkType && heroWorkType !== 'all') {
      const label = heroWorkType === 'remote' ? 'Remote' : heroWorkType === 'hybrid' ? 'Hybrid' : 'On-site';
      if (!parts.some(p => p.includes(label))) parts.push(label);
    }
    return parts.join(' · ');
  }

  function updateAlertBannerVisibility() {
    const banner = document.getElementById('alert-banner');
    const dismissed = localStorage.getItem(ALERT_BANNER_KEY) === 'true';

    // Only show banner if filters are active and not dismissed
    if (hasActiveFilters() && !dismissed && !banner.classList.contains('alert-banner-success')) {
      banner.classList.remove('hidden');
      const desc = banner.querySelector('.alert-banner-desc');
      if (desc) {
        desc.textContent = `We'll email you when new jobs match: ${getFilterDescription()}`;
      }
    } else if (!hasActiveFilters()) {
      banner.classList.add('hidden');
    }
  }

  function createEmailAlert() {
    const emailInput = document.getElementById('alert-email');
    const email = emailInput.value.trim();
    const btn = document.getElementById('create-alert-btn');

    // Basic email validation
    if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
      emailInput.style.borderColor = 'var(--red)';
      emailInput.focus();
      return;
    }

    const filters = getCurrentFilters();

    // Show loading state
    btn.disabled = true;
    btn.textContent = 'Creating...';

    // Simulate API call (in production, this would send to your backend)
    setTimeout(() => {
      // Store alert locally (in production, this goes to your backend)
      const alerts = JSON.parse(localStorage.getItem('jobpulse_email_alerts') || '[]');
      alerts.push({
        id: Date.now(),
        email,
        filters,
        createdAt: new Date().toISOString()
      });
      localStorage.setItem('jobpulse_email_alerts', JSON.stringify(alerts));

      // Show success state
      const banner = document.getElementById('alert-banner');
      banner.classList.add('alert-banner-success');
      banner.querySelector('.alert-banner-title').textContent = 'Alert created!';
      banner.querySelector('.alert-banner-desc').textContent = `We'll notify ${email} when new matching jobs are posted.`;
      banner.querySelector('.alert-banner-form').innerHTML = `
        <button class="btn-alert-submit" onclick="document.getElementById('alert-banner').classList.add('hidden')">Got it</button>
      `;
    }, 800);
  }

  function initAlertBanner() {
    const banner = document.getElementById('alert-banner');
    const closeBtn = document.getElementById('close-alert-banner');
    const createBtn = document.getElementById('create-alert-btn');
    const emailInput = document.getElementById('alert-email');

    // Hide by default - only show when filters are active
    banner.classList.add('hidden');

    closeBtn.addEventListener('click', () => {
      banner.classList.add('hidden');
      localStorage.setItem(ALERT_BANNER_KEY, 'true');
    });

    createBtn.addEventListener('click', createEmailAlert);

    emailInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') createEmailAlert();
    });

    emailInput.addEventListener('input', () => {
      emailInput.style.borderColor = '';
    });

    // Check initial filter state
    updateAlertBannerVisibility();
  }

  // ── Init ──────────────────────────────────────
  (async () => {
    await initAuth();
    loadJobs();
    loadSuggestions().then(() => {
      setupAutocomplete('filter-role', 'role-suggestions', () => allRoles, false);
      setupAutocomplete('filter-location', 'location-suggestions', () => allLocations, true);
    });

    // Start animated placeholder
    const roleInput = document.getElementById('filter-role');
    animatePlaceholder(roleInput, [
      'Software Engineer',
      'Product Manager',
      'UX Designer',
      'Data Scientist',
      'DevOps Engineer',
      'Frontend Developer'
    ]);

    // Setup scroll reveal
    setupScrollReveal();

    // Setup magnetic buttons
    setupMagneticButtons();

    // Currency selector
    const currencySelect = document.getElementById('currency-select');
    currencySelect.addEventListener('change', () => {
      displayCurrency = currencySelect.value;
      loadJobs(); // Re-render with new currency
    });

    // Job alerts banner
    initAlertBanner();

    // Update alert banner visibility when filters change
    ['filter-role', 'filter-location', 'filter-salary'].forEach(id => {
      document.getElementById(id).addEventListener('change', updateAlertBannerVisibility);
      document.getElementById(id).addEventListener('input', updateAlertBannerVisibility);
    });

    // Source dropdown should immediately trigger reload
    document.getElementById('filter-source').addEventListener('change', () => {
      page = 1;
      loadJobs();
      updateAlertBannerVisibility();
    });
    document.querySelectorAll('.chip input').forEach(input => {
      input.addEventListener('change', updateAlertBannerVisibility);
    });

    // Hero work type buttons
    document.querySelectorAll('.work-type-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.work-type-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        heroWorkType = btn.dataset.type;
        page = 1;
        loadJobs();
        updateAlertBannerVisibility();
      });
    });
  })();
})();
</script>
</body>
</html>
