<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JobPulse — Find Your Next Tech Job</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg-base: #fafbfc;
      --bg-surface: #ffffff;
      --bg-card: #ffffff;
      --bg-elevated: #f4f5f7;
      --bg-hover: #eef0f3;
      --text-primary: #1a1a2e;
      --text-secondary: #5a5a72;
      --text-tertiary: #8a8aa3;
      --border: rgba(0,0,0,0.08);
      --border-subtle: rgba(0,0,0,0.05);
      --accent: #6366f1;
      --accent-light: #818cf8;
      --accent-glow: rgba(99,102,241,0.1);
      --green: #10b981;
      --green-glow: rgba(16,185,129,0.1);
      --orange: #f59e0b;
      --orange-glow: rgba(245,158,11,0.1);
      --red: #ef4444;
      --cyan: #06b6d4;
      --cyan-glow: rgba(6,182,212,0.1);
      --radius: 20px;
      --radius-sm: 12px;
      --shadow-sm: 0 1px 2px rgba(0,0,0,0.04), 0 2px 8px rgba(0,0,0,0.04);
      --shadow: 0 2px 4px rgba(0,0,0,0.04), 0 8px 24px rgba(0,0,0,0.06);
      --shadow-lg: 0 4px 12px rgba(0,0,0,0.05), 0 16px 40px rgba(0,0,0,0.08);
      --sidebar-width: 260px;
    }

    body {
      background: var(--bg-base);
      color: var(--text-primary);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }

    /* ── Animations ─────────────────────────────── */
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-10px); }
      to { opacity: 1; transform: translateX(0); }
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.7; transform: scale(1.05); }
    }
    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    @keyframes float {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(5deg); }
    }
    @keyframes gradient-shift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    @keyframes glow-pulse {
      0%, 100% { box-shadow: 0 0 20px rgba(99,102,241,0.3); }
      50% { box-shadow: 0 0 40px rgba(99,102,241,0.5); }
    }
    .animate-fade-up {
      animation: fadeUp 0.5s ease-out forwards;
    }
    .animate-fade-up:nth-child(1) { animation-delay: 0s; }
    .animate-fade-up:nth-child(2) { animation-delay: 0.05s; }
    .animate-fade-up:nth-child(3) { animation-delay: 0.1s; }
    .animate-fade-up:nth-child(4) { animation-delay: 0.15s; }
    .animate-fade-up:nth-child(5) { animation-delay: 0.2s; }

    /* ── Navbar ─────────────────────────────────── */
    .navbar {
      position: sticky;
      top: 0;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 2.5rem;
      height: 64px;
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      border-bottom: 1px solid rgba(255,255,255,0.5);
      box-shadow: 0 1px 3px rgba(0,0,0,0.04), 0 4px 12px rgba(0,0,0,0.02);
    }
    .navbar-brand {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      font-size: 1.15rem;
      font-weight: 700;
      color: var(--text-primary);
      text-decoration: none;
      letter-spacing: -0.02em;
      transition: all 0.2s ease;
    }
    .navbar-brand:hover {
      opacity: 0.8;
    }
    .navbar-brand svg {
      width: 26px;
      height: 26px;
      color: var(--accent);
      transition: transform 0.3s ease;
    }
    .navbar-brand:hover svg {
      transform: rotate(-10deg) scale(1.1);
    }
    .navbar-nav {
      display: flex;
      gap: 0.5rem;
    }
    .nav-link {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.6rem 1.2rem;
      background: none;
      border: none;
      border-radius: var(--radius-sm);
      font-family: inherit;
      font-size: 0.9rem;
      font-weight: 500;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .nav-link:hover {
      background: var(--bg-elevated);
      color: var(--text-primary);
      transform: translateY(-1px);
    }
    .nav-link.active {
      background: linear-gradient(135deg, var(--accent) 0%, #8b5cf6 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(99,102,241,0.3), 0 0 0 1px rgba(255,255,255,0.1) inset;
    }
    .nav-link svg {
      width: 18px;
      height: 18px;
    }
    @media (max-width: 500px) {
      .navbar { padding: 0 1.25rem; }
      .nav-link span { display: none; }
      .nav-link { padding: 0.6rem 0.8rem; }
    }

    /* ── View Toggle ─────────────────────────────── */
    .view { display: none; }
    .view.active { display: block; animation: fadeIn 0.3s ease; }

    /* ── Search Hero ─────────────────────────────── */
    .hero {
      padding: 5rem 2rem 4rem;
      background: linear-gradient(180deg, #f8f9ff 0%, var(--bg-base) 100%);
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    /* Dot grid pattern */
    .hero::before {
      content: '';
      position: absolute;
      inset: 0;
      background-image: radial-gradient(circle at 1px 1px, rgba(99,102,241,0.15) 1px, transparent 0);
      background-size: 40px 40px;
      pointer-events: none;
      mask-image: radial-gradient(ellipse 80% 80% at 50% 30%, black 30%, transparent 70%);
      -webkit-mask-image: radial-gradient(ellipse 80% 80% at 50% 30%, black 30%, transparent 70%);
    }
    /* Gradient orbs */
    .hero::after {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle at 30% 20%, rgba(99,102,241,0.12) 0%, transparent 40%),
                  radial-gradient(circle at 70% 60%, rgba(16,185,129,0.08) 0%, transparent 35%),
                  radial-gradient(circle at 20% 80%, rgba(245,158,11,0.06) 0%, transparent 30%);
      pointer-events: none;
      animation: float 20s ease-in-out infinite;
    }
    /* Floating shapes */
    .hero-shapes {
      position: absolute;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
    }
    .hero-shape {
      position: absolute;
      border-radius: 50%;
      filter: blur(1px);
    }
    .hero-shape:nth-child(1) {
      width: 300px;
      height: 300px;
      top: -100px;
      right: -50px;
      background: linear-gradient(135deg, rgba(99,102,241,0.1) 0%, rgba(129,140,248,0.05) 100%);
      animation: float 15s ease-in-out infinite;
    }
    .hero-shape:nth-child(2) {
      width: 200px;
      height: 200px;
      bottom: -50px;
      left: -30px;
      background: linear-gradient(135deg, rgba(16,185,129,0.08) 0%, rgba(6,182,212,0.04) 100%);
      animation: float 18s ease-in-out infinite reverse;
    }
    .hero-shape:nth-child(3) {
      width: 150px;
      height: 150px;
      top: 30%;
      left: 10%;
      background: linear-gradient(135deg, rgba(245,158,11,0.06) 0%, transparent 100%);
      animation: float 12s ease-in-out infinite;
      animation-delay: -5s;
    }
    .hero-inner {
      max-width: 640px;
      margin: 0 auto;
      animation: fadeUp 0.6s ease-out;
      position: relative;
      z-index: 1;
    }
    .hero-eyebrow {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1.25rem;
      background: linear-gradient(135deg, rgba(16,185,129,0.15) 0%, rgba(6,182,212,0.1) 100%);
      border: 1px solid rgba(16,185,129,0.2);
      border-radius: 100px;
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--green);
      margin-bottom: 1.5rem;
      box-shadow: 0 0 20px rgba(16,185,129,0.15);
    }
    .hero-eyebrow .dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--green);
      animation: pulse 2s ease-in-out infinite;
    }
    .hero h1 {
      font-size: 2.75rem;
      font-weight: 800;
      letter-spacing: -0.03em;
      line-height: 1.15;
      margin-bottom: 1.5rem;
      color: var(--text-primary);
      background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .hero-browse {
      margin-top: 1.25rem;
      font-size: 0.9rem;
      color: var(--text-tertiary);
    }
    .hero-browse a {
      color: var(--accent);
      text-decoration: none;
      font-weight: 600;
      transition: all 0.2s;
    }
    .hero-browse a:hover {
      color: var(--accent-light);
    }

    /* Hero Search Bar */
    .hero-search {
      display: flex;
      gap: 0.75rem;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 0.6rem;
      box-shadow: var(--shadow-lg), 0 0 0 1px rgba(255,255,255,0.8) inset;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
    }
    .hero-search::before {
      content: '';
      position: absolute;
      inset: -2px;
      border-radius: calc(var(--radius) + 2px);
      background: linear-gradient(135deg, var(--accent), var(--green), var(--cyan), var(--accent));
      background-size: 300% 300%;
      opacity: 0;
      z-index: -1;
      transition: opacity 0.4s ease;
    }
    .hero-search:focus-within {
      box-shadow: var(--shadow-lg), 0 0 30px rgba(99,102,241,0.15);
      transform: translateY(-3px);
      border-color: transparent;
    }
    .hero-search:focus-within::before {
      opacity: 1;
      animation: gradient-shift 3s ease infinite;
    }
    .hero-search .autocomplete-wrap {
      flex: 1;
      min-width: 0;
    }
    .hero-search .filter-input {
      width: 100%;
      padding: 1rem 1.25rem;
      background: var(--bg-elevated);
      border: none;
      border-radius: var(--radius-sm);
      color: var(--text-primary);
      font-size: 1rem;
      font-family: inherit;
      transition: all 0.2s;
      outline: none;
    }
    .hero-search .filter-input:focus {
      background: var(--bg-hover);
    }
    .hero-search .filter-input::placeholder { color: var(--text-tertiary); }
    .hero-search .btn-accent {
      padding: 1rem 2rem;
      flex-shrink: 0;
    }

    @media (max-width: 600px) {
      .hero { padding: 3rem 1.5rem 2.5rem; }
      .hero h1 { font-size: 2rem; }
      .hero-search { flex-direction: column; }
      .hero-search .btn-accent { width: 100%; }
    }

    /* ── Main Layout (Two-Column) ──────────────────── */
    .main-layout {
      display: grid;
      grid-template-columns: var(--sidebar-width) 1fr;
      gap: 2.5rem;
      max-width: 1400px;
      margin: 0 auto;
      padding: 2.5rem;
    }

    /* ── Filters Sidebar ───────────────────────────── */
    .filters-sidebar {
      position: sticky;
      top: calc(64px + 2rem);
      height: fit-content;
      max-height: calc(100vh - 64px - 4rem);
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      animation: slideIn 0.4s ease-out;
    }
    .filters-sidebar::-webkit-scrollbar { width: 4px; }
    .filters-sidebar::-webkit-scrollbar-track { background: transparent; }
    .filters-sidebar::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }

    .filter-box {
      background: rgba(255,255,255,0.7);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.8);
      border-radius: var(--radius);
      padding: 1.5rem;
      box-shadow: var(--shadow-sm), 0 0 0 1px rgba(0,0,0,0.02) inset;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .filter-box:hover {
      box-shadow: var(--shadow), 0 0 0 1px rgba(99,102,241,0.1);
      transform: translateY(-2px);
      border-color: rgba(99,102,241,0.1);
    }
    .filter-box-label {
      font-size: 0.7rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-tertiary);
      margin-bottom: 0.85rem;
      display: block;
    }
    .checkbox-group {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .chip {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.5rem 0.9rem;
      background: var(--bg-elevated);
      border: 1px solid rgba(0,0,0,0.04);
      border-radius: 100px;
      font-size: 0.8rem;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      user-select: none;
      position: relative;
      overflow: hidden;
    }
    .chip::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, transparent 0%, rgba(255,255,255,0.5) 100%);
      opacity: 0;
      transition: opacity 0.2s;
    }
    .chip:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.06);
    }
    .chip:hover::before {
      opacity: 1;
    }
    label.chip.active,
    .chip.active {
      background: linear-gradient(135deg, var(--accent) 0%, #8b5cf6 100%) !important;
      border-color: transparent !important;
      color: #ffffff !important;
      font-weight: 600;
      box-shadow: 0 4px 14px rgba(99,102,241,0.35);
      transform: translateY(-1px);
    }
    label.chip.active::after,
    .chip.active::after {
      content: '\2713';
      font-size: 0.7rem;
      font-weight: 700;
      margin-left: 0.2rem;
    }
    label.chip.active:hover,
    .chip.active:hover {
      background: linear-gradient(135deg, var(--accent-light) 0%, #a78bfa 100%) !important;
      box-shadow: 0 6px 18px rgba(99,102,241,0.4);
    }
    .chip input { display: none; }

    .sidebar-salary {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }
    .sidebar-salary .filter-input {
      flex: 1;
      padding: 0.7rem 1rem;
      background: var(--bg-elevated);
      border: 1px solid transparent;
      border-radius: var(--radius-sm);
      color: var(--text-primary);
      font-size: 0.875rem;
      font-family: inherit;
      outline: none;
      transition: all 0.2s;
    }
    .sidebar-salary .filter-input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-glow);
    }
    .sidebar-salary .filter-input::placeholder { color: var(--text-tertiary); }

    .sidebar-source select.filter-input {
      width: 100%;
      padding: 0.7rem 1rem;
      background: var(--bg-elevated);
      border: 1px solid transparent;
      border-radius: var(--radius-sm);
      color: var(--text-primary);
      font-size: 0.875rem;
      font-family: inherit;
      cursor: pointer;
      outline: none;
      transition: all 0.2s;
    }
    .sidebar-source select.filter-input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-glow);
    }
    .sidebar-source select.filter-input option {
      background: var(--bg-card);
      color: var(--text-primary);
    }

    .btn-clear-filters {
      width: 100%;
      padding: 0.8rem;
      background: transparent;
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      color: var(--text-secondary);
      font-size: 0.85rem;
      font-weight: 500;
      font-family: inherit;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-clear-filters:hover {
      background: var(--bg-elevated);
      color: var(--text-primary);
      border-color: var(--border);
    }

    /* ── Listings Main Area ────────────────────────── */
    .listings-main {
      min-width: 0;
      animation: fadeUp 0.5s ease-out;
    }

    /* ── Cards ─────────────────────────────────────── */
    .card {
      background: rgba(255,255,255,0.9);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.8);
      border-radius: var(--radius);
      padding: 1.75rem;
      box-shadow: var(--shadow), 0 0 0 1px rgba(0,0,0,0.02) inset;
    }
    .table-section.card {
      padding: 1.5rem 1.75rem;
      background: var(--bg-card);
    }
    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.25rem;
    }
    .card-title {
      font-size: 0.95rem;
      font-weight: 600;
      color: var(--text-secondary);
    }
    .card-badge {
      font-size: 0.7rem;
      font-weight: 600;
      padding: 0.35rem 0.85rem;
      background: linear-gradient(135deg, rgba(99,102,241,0.12) 0%, rgba(139,92,246,0.08) 100%);
      border: 1px solid rgba(99,102,241,0.15);
      border-radius: 100px;
      color: var(--accent);
    }
    .card-badge[data-live="true"] {
      position: relative;
    }
    .card-badge[data-live="true"]::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 8px;
      transform: translateY(-50%);
      width: 6px;
      height: 6px;
      background: var(--green);
      border-radius: 50%;
      animation: pulse 2s ease-in-out infinite;
    }

    /* ── Job Listings ─────────────────────────────────── */
    .table-section { margin-bottom: 1.5rem; }
    .jobs-list { display: flex; flex-direction: column; gap: 0.6rem; }

    .job-card {
      display: grid;
      grid-template-columns: 32px minmax(200px, 2fr) minmax(120px, 1fr) minmax(100px, 1fr) minmax(100px, 140px) 85px 36px;
      gap: 1.25rem;
      align-items: center;
      padding: 1.1rem 1.5rem;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      cursor: pointer;
      transition: all 0.25s ease;
      text-decoration: none;
      box-shadow: var(--shadow-sm);
    }
    .job-card {
      opacity: 0;
      animation: fadeUp 0.4s ease-out forwards;
      position: relative;
      overflow: hidden;
    }
    /* Shine effect */
    .job-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -75%;
      width: 50%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      transform: skewX(-25deg);
      transition: left 0.5s ease;
      pointer-events: none;
    }
    .job-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg), 0 0 0 1px rgba(99,102,241,0.1);
      border-color: rgba(99,102,241,0.15);
    }
    .job-card:hover::before {
      left: 125%;
    }
    .job-card:nth-child(1) { animation-delay: 0s; }
    .job-card:nth-child(2) { animation-delay: 0.03s; }
    .job-card:nth-child(3) { animation-delay: 0.06s; }
    .job-card:nth-child(4) { animation-delay: 0.09s; }
    .job-card:nth-child(5) { animation-delay: 0.12s; }
    .job-card:nth-child(6) { animation-delay: 0.15s; }
    .job-card:nth-child(7) { animation-delay: 0.18s; }
    .job-card:nth-child(8) { animation-delay: 0.21s; }
    .job-card:nth-child(9) { animation-delay: 0.24s; }
    .job-card:nth-child(10) { animation-delay: 0.27s; }
    .job-card:hover .job-arrow { opacity: 1; color: var(--accent); }

    .job-main { display: flex; flex-direction: column; gap: 0.3rem; min-width: 0; }
    .job-title {
      font-size: 0.95rem;
      font-weight: 600;
      color: var(--text-primary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .job-company {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      font-size: 0.82rem;
      color: var(--text-secondary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .job-company svg { width: 14px; height: 14px; opacity: 0.4; flex-shrink: 0; }

    .job-location {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
      font-size: 0.85rem;
      color: var(--text-secondary);
      min-width: 0;
    }
    .job-location-text {
      display: flex;
      align-items: center;
      gap: 0.35rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .job-location svg { width: 14px; height: 14px; opacity: 0.4; flex-shrink: 0; }

    .work-type {
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      padding: 0.25rem 0.6rem;
      border-radius: 100px;
      font-size: 0.7rem;
      font-weight: 600;
      width: fit-content;
    }
    .work-type.remote {
      background: var(--green-glow);
      color: var(--green);
    }
    .work-type.hybrid {
      background: var(--orange-glow);
      color: var(--orange);
    }
    .work-type.onsite {
      background: var(--accent-glow);
      color: var(--accent);
    }
    .work-type svg { width: 11px; height: 11px; }

    .job-tags { display: flex; gap: 0.35rem; flex-wrap: wrap; }

    .job-salary {
      font-size: 0.9rem;
      font-weight: 700;
      color: var(--green);
      white-space: nowrap;
      text-align: right;
    }
    .job-salary.none {
      font-size: 0.82rem;
      font-weight: 400;
      color: var(--text-tertiary);
    }

    .job-source {
      padding: 0.35rem 0.75rem;
      border-radius: 100px;
      font-size: 0.72rem;
      font-weight: 600;
      letter-spacing: 0.02em;
      text-align: center;
      white-space: nowrap;
    }
    .job-source.remoteok { background: var(--green-glow); color: var(--green); }
    .job-source.arbeitnow { background: var(--accent-glow); color: var(--accent); }
    .job-source.jobicy { background: var(--orange-glow); color: var(--orange); }

    .job-arrow {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      color: var(--text-tertiary);
      opacity: 0;
      transition: all 0.2s;
    }
    .job-arrow svg { width: 18px; height: 18px; }

    .tag {
      display: inline-block;
      padding: 0.25rem 0.6rem;
      background: var(--accent-glow);
      color: var(--accent);
      border-radius: 100px;
      font-size: 0.7rem;
      font-weight: 500;
    }

    .no-results {
      text-align: center;
      padding: 4rem 1rem;
      color: var(--text-tertiary);
      font-size: 0.95rem;
    }

    /* Header row for job listings */
    .jobs-header {
      display: grid;
      grid-template-columns: 32px minmax(200px, 2fr) minmax(120px, 1fr) minmax(100px, 1fr) minmax(100px, 140px) 85px 36px;
      gap: 1.25rem;
      padding: 0.75rem 1.5rem;
      font-size: 0.72rem;
      font-weight: 600;
      color: var(--text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.06em;
      border-bottom: 1px solid var(--border);
      margin-bottom: 0.5rem;
    }
    .jobs-header span:nth-child(5),
    .jobs-header span:nth-child(6) { text-align: right; }

    .col-filter {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      cursor: pointer;
      padding: 0.25rem 0.5rem;
      margin: -0.25rem -0.5rem;
      border-radius: 6px;
      transition: all 0.2s;
      user-select: none;
    }
    .col-filter:hover { background: var(--bg-elevated); color: var(--text-secondary); }
    .col-filter.active { background: var(--accent-glow); color: var(--accent); }
    .col-filter svg { width: 13px; height: 13px; opacity: 0.6; }
    .col-filter.active svg { opacity: 1; }

    .pagination {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1.25rem;
      padding: 1.5rem 0 0.5rem;
    }
    #page-info { font-size: 0.85rem; color: var(--text-tertiary); font-weight: 500; }

    /* ── Listing Tabs ─────────────────────────────── */
    .listing-tabs {
      display: flex;
      gap: 0.25rem;
    }
    .listing-tab {
      padding: 0.6rem 1.25rem;
      background: none;
      border: none;
      border-radius: var(--radius-sm);
      font-family: inherit;
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-tertiary);
      cursor: pointer;
      position: relative;
      transition: all 0.2s;
    }
    .listing-tab:hover {
      color: var(--text-secondary);
      background: var(--bg-elevated);
    }
    .listing-tab.active {
      color: var(--accent);
      background: var(--accent-glow);
    }
    .listing-tab .saved-count {
      font-size: 0.75rem;
      color: inherit;
      opacity: 0.7;
    }

    /* ── Bookmark Button ─────────────────────────── */
    .bookmark-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      background: none;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      color: var(--text-tertiary);
      opacity: 0.5;
      transition: all 0.2s;
      padding: 0;
      flex-shrink: 0;
    }
    .bookmark-btn:hover {
      opacity: 1;
      color: var(--accent);
      background: var(--accent-glow);
    }
    .bookmark-btn.saved { opacity: 1; color: var(--accent); background: var(--accent-glow); }
    .bookmark-btn.saved svg { fill: var(--accent); }
    .bookmark-btn svg { width: 18px; height: 18px; }
    @keyframes bookmark-pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }
    .bookmark-btn.pulse-anim {
      animation: bookmark-pulse 0.25s ease;
    }

    /* ── Buttons ───────────────────────────────────── */
    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: var(--radius-sm);
      font-weight: 600;
      font-size: 0.9rem;
      font-family: inherit;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .btn:active { transform: scale(0.97); }
    .btn-accent {
      background: linear-gradient(135deg, var(--accent) 0%, #8b5cf6 100%);
      color: white;
      box-shadow: 0 4px 14px rgba(99,102,241,0.35), 0 0 0 1px rgba(255,255,255,0.1) inset;
      position: relative;
      overflow: hidden;
    }
    .btn-accent::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s ease;
    }
    .btn-accent:hover {
      background: linear-gradient(135deg, var(--accent-light) 0%, #a78bfa 100%);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(99,102,241,0.45), 0 0 0 1px rgba(255,255,255,0.15) inset;
    }
    .btn-accent:hover::before {
      left: 100%;
    }
    .btn-ghost {
      background: var(--bg-card);
      color: var(--text-secondary);
      border: 1px solid var(--border);
    }
    .btn-ghost:hover {
      background: var(--bg-elevated);
      color: var(--text-primary);
      transform: translateY(-1px);
    }
    .btn-sm { padding: 0.5rem 1.1rem; font-size: 0.82rem; border-radius: 8px; }
    .btn-sm:disabled { opacity: 0.4; cursor: default; pointer-events: none; }

    /* ── Analytics View ────────────────────────────── */
    .analytics-view {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2.5rem;
    }
    .analytics-header {
      margin-bottom: 2rem;
      animation: fadeUp 0.5s ease-out;
    }
    .analytics-header h2 {
      font-size: 1.75rem;
      font-weight: 800;
      margin-bottom: 0.5rem;
      letter-spacing: -0.02em;
      background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent) 50%, var(--text-primary) 100%);
      background-size: 200% auto;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: gradient-shift 5s ease infinite;
    }
    .analytics-header p {
      font-size: 0.95rem;
      color: var(--text-secondary);
    }

    /* ── Insight Grid ──────────────────────────────── */
    .insight-grid {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }
    .insight-grid .card,
    .charts-grid .card {
      transition: all 0.3s ease;
    }
    .insight-grid .card:hover,
    .charts-grid .card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
    }
    .doughnut-wrap {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .doughnut-wrap canvas { max-width: 200px; max-height: 200px; }
    .insight-list { list-style: none; }
    .insight-list li {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.55rem 0;
      border-bottom: 1px solid var(--border-subtle);
      font-size: 0.85rem;
    }
    .insight-list li:last-child { border-bottom: none; }
    .insight-list .rank {
      width: 1.4rem;
      height: 1.4rem;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-elevated);
      border-radius: 6px;
      font-size: 0.68rem;
      font-weight: 700;
      color: var(--text-tertiary);
      flex-shrink: 0;
    }
    .insight-list li:nth-child(1) .rank { background: var(--accent-glow); color: var(--accent); }
    .insight-list li:nth-child(2) .rank { background: var(--green-glow); color: var(--green); }
    .insight-list li:nth-child(3) .rank { background: var(--orange-glow); color: var(--orange); }
    .insight-list .label { color: var(--text-secondary); flex: 1; margin-left: 0.6rem; }
    .insight-list .value { font-weight: 700; color: var(--text-primary); }

    /* ── Charts Grid ──────────────────────────────── */
    .charts-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
    }
    .chart-card { min-height: 300px; }
    .chart-card canvas { max-height: 250px; }

    /* ── Autocomplete ─────────────────────────────── */
    .autocomplete-wrap { position: relative; }
    .autocomplete-list {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-top: none;
      border-radius: 0 0 8px 8px;
      max-height: 200px;
      overflow-y: auto;
      z-index: 100;
      display: none;
    }
    .autocomplete-list.show { display: block; }
    .autocomplete-item {
      padding: 0.55rem 0.9rem;
      font-size: 0.82rem;
      color: var(--text-secondary);
      cursor: pointer;
      transition: background 0.1s;
    }
    .autocomplete-item:hover, .autocomplete-item.active {
      background: var(--bg-hover);
      color: var(--text-primary);
    }
    .autocomplete-item mark {
      background: transparent;
      color: var(--accent);
      font-weight: 600;
    }

    /* ── Footer ────────────────────────────────────── */
    footer {
      text-align: center;
      padding: 3rem 2rem;
      color: var(--text-tertiary);
      font-size: 0.85rem;
      border-top: 1px solid var(--border);
      margin-top: 2rem;
      background: var(--bg-surface);
    }
    footer p { margin-bottom: 1rem; }
    footer a { color: var(--accent); text-decoration: none; font-weight: 600; transition: color 0.2s; }
    footer a:hover { color: var(--accent-light); }
    .footer-tech {
      display: flex;
      justify-content: center;
      gap: 0.75rem;
      flex-wrap: wrap;
    }
    .footer-tech span {
      font-weight: 500;
      padding: 0.4rem 0.9rem;
      background: var(--bg-elevated);
      border-radius: 100px;
      font-size: 0.8rem;
      color: var(--text-secondary);
      transition: all 0.2s;
    }
    .footer-tech span:hover {
      background: var(--accent-glow);
      color: var(--accent);
    }

    /* ── Loading ────────────────────────────────────── */
    .loading-cell {
      text-align: center;
      padding: 3rem;
      color: var(--text-tertiary);
    }
    .spinner {
      display: inline-block;
      width: 20px; height: 20px;
      border: 2px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.6s linear infinite;
      margin-right: 0.5rem;
      vertical-align: middle;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Skeleton Loading */
    .skeleton {
      background: linear-gradient(90deg, var(--bg-elevated) 25%, var(--bg-hover) 50%, var(--bg-elevated) 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
      border-radius: 8px;
    }
    .skeleton-card {
      display: grid;
      grid-template-columns: 32px 1fr 1fr 100px;
      gap: 1.25rem;
      align-items: center;
      padding: 1.1rem 1.5rem;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
    }
    .skeleton-loading { display: flex; flex-direction: column; gap: 0.6rem; }
    .skeleton-bookmark { width: 32px; height: 32px; border-radius: 8px; }
    .skeleton-content { display: flex; flex-direction: column; gap: 0.5rem; }
    .skeleton-title { height: 18px; width: 70%; }
    .skeleton-subtitle { height: 14px; width: 50%; }
    .skeleton-location { height: 16px; width: 80%; }
    .skeleton-salary { height: 18px; width: 60px; margin-left: auto; }

    /* ── Animate in ────────────────────────────────── */
    .fade-in {
      opacity: 0;
      transform: translateY(12px);
      animation: fadeIn 0.5s ease forwards;
    }
    @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
    .fade-in:nth-child(1) { animation-delay: 0s; }
    .fade-in:nth-child(2) { animation-delay: 0.06s; }
    .fade-in:nth-child(3) { animation-delay: 0.12s; }
    .fade-in:nth-child(4) { animation-delay: 0.18s; }

    /* ── Responsive ────────────────────────────────── */
    @media (max-width: 1100px) {
      .job-card { grid-template-columns: 28px 1fr auto auto; }
      .job-location, .job-tags, .jobs-header { display: none; }
    }
    @media (max-width: 900px) {
      .main-layout {
        grid-template-columns: 1fr;
      }
      .filters-sidebar {
        position: static;
        max-height: none;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 0.5rem;
      }
      .filter-box {
        flex: 1;
        min-width: 200px;
      }
      .insight-grid { grid-template-columns: 1fr; }
      .charts-grid { grid-template-columns: 1fr; }
    }
    @media (max-width: 600px) {
      .job-card { grid-template-columns: 28px 1fr auto; padding: 0.85rem 1rem; }
      .job-source, .job-arrow { display: none; }
      .filters-sidebar { flex-direction: column; }
      .filter-box { min-width: 0; }
    }
  </style>
</head>
<body>

<!-- ── Navbar ───────────────────────────────────────── -->
<nav class="navbar">
  <a href="#" class="navbar-brand">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>
    JobPulse
  </a>
  <div class="navbar-nav">
    <button class="nav-link active" id="nav-jobs">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"/><path d="M16 21V5a2 2 0 00-2-2h-4a2 2 0 00-2 2v16"/></svg>
      <span>Jobs</span>
    </button>
    <button class="nav-link" id="nav-analytics">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>
      <span>Analytics</span>
    </button>
  </div>
</nav>

<!-- ── Jobs View ────────────────────────────────────── -->
<div class="view active" id="jobs-view">

<!-- ── Search Hero ──────────────────────────────────── -->
<section class="hero">
  <div class="hero-shapes">
    <div class="hero-shape"></div>
    <div class="hero-shape"></div>
    <div class="hero-shape"></div>
  </div>
  <div class="hero-inner">
    <p class="hero-eyebrow"><span class="dot"></span> <span id="hero-total">—</span> jobs from 3 sources</p>
    <h1>Tech jobs, all in one place</h1>
    <div class="hero-search">
      <div class="autocomplete-wrap">
        <input class="filter-input" type="text" id="filter-role" placeholder="Filter by title or keyword..." autocomplete="off" />
        <div class="autocomplete-list" id="role-suggestions"></div>
      </div>
      <div class="autocomplete-wrap">
        <input class="filter-input" type="text" id="filter-location" placeholder="Filter by location..." autocomplete="off" />
        <div class="autocomplete-list" id="location-suggestions"></div>
      </div>
      <button id="filter-btn" class="btn btn-accent">Filter</button>
    </div>
    <p class="hero-browse">or <a href="#listings" id="browse-link">browse all listings</a> below</p>
  </div>
</section>

<!-- ── Main Layout ──────────────────────────────────── -->
<div class="main-layout">

  <!-- ── Filters Sidebar ──────────────────────────── -->
  <aside class="filters-sidebar">
    <div class="filter-box">
      <span class="filter-box-label">Seniority Level</span>
      <div class="checkbox-group" id="seniority-chips">
        <label class="chip"><input type="checkbox" value="senior">Senior</label>
        <label class="chip"><input type="checkbox" value="mid">Mid-Level</label>
        <label class="chip"><input type="checkbox" value="junior">Junior</label>
        <label class="chip"><input type="checkbox" value="lead">Lead</label>
        <label class="chip"><input type="checkbox" value="manager">Manager</label>
        <label class="chip"><input type="checkbox" value="director">Director</label>
        <label class="chip"><input type="checkbox" value="staff">Staff</label>
        <label class="chip"><input type="checkbox" value="principal">Principal</label>
      </div>
    </div>

    <div class="filter-box">
      <span class="filter-box-label">Role Category</span>
      <div class="checkbox-group" id="role-chips">
        <label class="chip"><input type="checkbox" value="engineer,developer,software">Engineering</label>
        <label class="chip"><input type="checkbox" value="data,analytics,scientist">Data</label>
        <label class="chip"><input type="checkbox" value="product">Product</label>
        <label class="chip"><input type="checkbox" value="design,ux,ui">Design</label>
        <label class="chip"><input type="checkbox" value="marketing">Marketing</label>
        <label class="chip"><input type="checkbox" value="sales,business,account">Sales</label>
        <label class="chip"><input type="checkbox" value="hr,recruiting,people,talent">HR</label>
        <label class="chip"><input type="checkbox" value="support,customer,success">Support</label>
        <label class="chip"><input type="checkbox" value="operations,ops">Ops</label>
        <label class="chip"><input type="checkbox" value="devops,sre,infrastructure,cloud">DevOps</label>
        <label class="chip"><input type="checkbox" value="security">Security</label>
        <label class="chip"><input type="checkbox" value="ai,ml,machine learning">AI/ML</label>
      </div>
    </div>

    <div class="filter-box">
      <span class="filter-box-label">Work Arrangement</span>
      <div class="checkbox-group" id="worktype-chips">
        <label class="chip"><input type="checkbox" value="remote">Remote</label>
        <label class="chip"><input type="checkbox" value="hybrid">Hybrid</label>
        <label class="chip"><input type="checkbox" value="onsite">On-site</label>
      </div>
    </div>

    <div class="filter-box">
      <span class="filter-box-label">Minimum Salary</span>
      <div class="sidebar-salary">
        <input class="filter-input" type="number" id="filter-salary" placeholder="e.g. 80000" />
      </div>
    </div>

    <div class="filter-box sidebar-source">
      <span class="filter-box-label">Source</span>
      <select class="filter-input" id="filter-source">
        <option value="">All Sources</option>
        <option value="remoteok">RemoteOK</option>
        <option value="arbeitnow">Arbeitnow</option>
        <option value="jobicy">Jobicy</option>
      </select>
    </div>

    <button id="clear-btn" class="btn-clear-filters">Clear All Filters</button>
  </aside>

  <!-- ── Job Listings ─────────────────────────────── -->
  <main class="listings-main" id="listings">
    <section class="card table-section">
      <div class="card-header">
        <div class="listing-tabs">
          <button class="listing-tab active" id="tab-all">All Jobs</button>
          <button class="listing-tab" id="tab-saved">Saved <span class="saved-count">(0)</span></button>
        </div>
        <span class="card-badge" id="results-count">—</span>
      </div>
      <div class="jobs-header">
        <span></span>
        <span>Position</span>
        <span>Location</span>
        <span>Skills</span>
        <span>
          <span class="col-filter" id="salary-filter" title="Click to filter by salary">
            Salary
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 4h13M3 8h9m-9 4h6m4 0l4 4m0 0l4-4m-4 4V4"/></svg>
          </span>
        </span>
        <span>Source</span>
        <span></span>
      </div>
      <div class="jobs-list" id="jobs-list">
        <div class="skeleton-loading">
          <div class="skeleton-card"><div class="skeleton skeleton-bookmark"></div><div class="skeleton-content"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-subtitle"></div></div><div class="skeleton skeleton-location"></div><div class="skeleton skeleton-salary"></div></div>
          <div class="skeleton-card"><div class="skeleton skeleton-bookmark"></div><div class="skeleton-content"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-subtitle"></div></div><div class="skeleton skeleton-location"></div><div class="skeleton skeleton-salary"></div></div>
          <div class="skeleton-card"><div class="skeleton skeleton-bookmark"></div><div class="skeleton-content"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-subtitle"></div></div><div class="skeleton skeleton-location"></div><div class="skeleton skeleton-salary"></div></div>
          <div class="skeleton-card"><div class="skeleton skeleton-bookmark"></div><div class="skeleton-content"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-subtitle"></div></div><div class="skeleton skeleton-location"></div><div class="skeleton skeleton-salary"></div></div>
          <div class="skeleton-card"><div class="skeleton skeleton-bookmark"></div><div class="skeleton-content"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-subtitle"></div></div><div class="skeleton skeleton-location"></div><div class="skeleton skeleton-salary"></div></div>
        </div>
      </div>
      <div class="pagination">
        <button id="prev-page" class="btn btn-ghost btn-sm" disabled>&larr; Previous</button>
        <span id="page-info">Page 1</span>
        <button id="next-page" class="btn btn-ghost btn-sm">Next &rarr;</button>
      </div>
    </section>
  </main>

</div>

</div><!-- /jobs-view -->

<!-- ── Analytics View ───────────────────────────────── -->
<div class="view" id="analytics-view">
  <div class="analytics-view">
    <div class="analytics-header">
      <h2>Market Analytics</h2>
      <p>Insights from aggregated job listings across all sources</p>
    </div>
    <!-- Insight Row: Sources Doughnut + Top Tags + Top Companies -->
    <section class="insight-grid">
      <div class="card fade-in">
        <div class="card-header">
          <span class="card-title">Sources Breakdown</span>
          <span class="card-badge">Live</span>
        </div>
        <div class="doughnut-wrap">
          <canvas id="sources-doughnut"></canvas>
        </div>
      </div>
      <div class="card fade-in">
        <div class="card-header">
          <span class="card-title">Top Skills</span>
          <span class="card-badge">By frequency</span>
        </div>
        <ul class="insight-list" id="top-tags-list"></ul>
      </div>
      <div class="card fade-in">
        <div class="card-header">
          <span class="card-title">Top Companies</span>
          <span class="card-badge">Most listings</span>
        </div>
        <ul class="insight-list" id="top-companies-list"></ul>
      </div>
    </section>

    <!-- Charts -->
    <section class="charts-grid">
      <div class="card chart-card fade-in">
        <div class="card-header">
          <span class="card-title">Salary Distribution</span>
          <span class="card-badge">USD equivalent</span>
        </div>
        <canvas id="salary-chart"></canvas>
      </div>
      <div class="card chart-card fade-in">
        <div class="card-header">
          <span class="card-title">Scrape History</span>
          <span class="card-badge">Added vs Removed</span>
        </div>
        <canvas id="history-chart"></canvas>
      </div>
    </section>
  </div>
</div><!-- /analytics-view -->

<footer>
  <p>JobPulse &mdash; Resilient data pipeline demo &mdash; <a href="https://github.com/AntoineKoerber/JobPulse">View Source &amp; Architecture</a></p>
  <div class="footer-tech">
    <span>Python</span>
    <span>FastAPI</span>
    <span>Supabase</span>
    <span>Chart.js</span>
    <span>Playwright</span>
  </div>
</footer>

<script>
(() => {
  'use strict';

  const SB = 'https://rbwfnhnuvedrljlawisq.supabase.co';
  const KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJid2ZuaG51dmVkcmxqbGF3aXNxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk4MzIwMzgsImV4cCI6MjA4NTQwODAzOH0.wSCGwvtKp-t8FJB6NsCKdwnJJFzHUIldAzMLxgvxL_c';
  const H = { 'apikey': KEY, 'Authorization': `Bearer ${KEY}` };

  const q = (t, p = '') => fetch(`${SB}/rest/v1/${t}?${p}`, { headers: H });

  // ── Supabase Client ─────────────────────────────
  const supabase = window.supabase.createClient(SB, KEY);
  let currentUserId = null;

  let page = 1;
  const PAGE_SIZE = 50;
  let salaryChart, historyChart, doughnutChart;
  let allLocations = [];
  let allRoles = [];
  let salaryFilter = 'all'; // 'all', 'has', 'none'
  let viewMode = 'all'; // 'all' | 'saved'
  let analyticsLoaded = false;

  // ── Saved / Bookmark helpers (Supabase) ─────────
  let savedIds = new Set();

  async function initAuth() {
    // Check for existing session
    const { data: { session } } = await supabase.auth.getSession();
    if (session?.user) {
      currentUserId = session.user.id;
    } else {
      // Create anonymous session
      const { data, error } = await supabase.auth.signInAnonymously();
      if (error) {
        console.error('Anonymous auth failed:', error);
        return;
      }
      currentUserId = data.user.id;
    }
    await loadSavedIds();
  }

  async function loadSavedIds() {
    if (!currentUserId) return;
    const { data, error } = await supabase
      .from('saved_jobs')
      .select('job_id')
      .eq('user_id', currentUserId);
    if (error) {
      console.error('Failed to load saved jobs:', error);
      return;
    }
    savedIds = new Set(data.map(r => r.job_id));
    updateSavedCount();
  }

  function isSaved(id) { return savedIds.has(id); }

  async function toggleSaved(id) {
    if (!currentUserId) return;
    if (savedIds.has(id)) {
      // Remove from saved
      const { error } = await supabase
        .from('saved_jobs')
        .delete()
        .eq('user_id', currentUserId)
        .eq('job_id', id);
      if (!error) savedIds.delete(id);
    } else {
      // Add to saved
      const { error } = await supabase
        .from('saved_jobs')
        .insert({ user_id: currentUserId, job_id: id });
      if (!error) savedIds.add(id);
    }
    updateSavedCount();
  }

  function updateSavedCount() {
    const el = document.querySelector('#tab-saved .saved-count');
    if (el) el.textContent = `(${savedIds.size})`;
  }

  // ── Decode HTML entities ─────────────────────
  function decodeHtml(s) {
    if (!s) return '';
    const txt = document.createElement('textarea');
    txt.innerHTML = s;
    return txt.value;
  }

  // ── Autocomplete ─────────────────────────────
  async function loadSuggestions() {
    try {
      const res = await q('job_listings', 'is_active=eq.true&select=location,title');
      const data = await res.json();

      // Unique locations
      const locSet = new Set();
      data.forEach(d => { if (d.location && d.location.length > 1) locSet.add(d.location); });
      allLocations = [...locSet].sort();

      // Common role keywords from titles
      const roleWords = {};
      const rolePatterns = ['engineer', 'developer', 'manager', 'designer', 'analyst', 'director', 'lead', 'senior', 'junior', 'architect', 'consultant', 'specialist', 'coordinator', 'associate', 'assistant', 'intern', 'head', 'vp', 'chief', 'officer', 'admin', 'support', 'sales', 'marketing', 'product', 'project', 'data', 'software', 'frontend', 'backend', 'fullstack', 'devops', 'cloud', 'security', 'qa', 'test', 'mobile', 'ios', 'android', 'web', 'ui', 'ux', 'hr', 'finance', 'operations', 'customer', 'success', 'account', 'business', 'content', 'writer', 'editor'];
      data.forEach(d => {
        const words = (d.title || '').toLowerCase().split(/\s+/);
        words.forEach(w => {
          if (rolePatterns.some(p => w.includes(p)) && w.length > 2) {
            roleWords[w] = (roleWords[w] || 0) + 1;
          }
        });
      });
      allRoles = Object.entries(roleWords).filter(([k, v]) => v >= 3).sort((a, b) => b[1] - a[1]).map(([k]) => k);
    } catch (e) { console.error('Failed to load suggestions', e); }
  }

  function setupAutocomplete(inputId, listId, getSuggestions) {
    const input = document.getElementById(inputId);
    const list = document.getElementById(listId);
    let activeIdx = -1;

    input.addEventListener('input', () => {
      const val = input.value.toLowerCase().trim();
      if (val.length < 1) { list.classList.remove('show'); return; }

      const matches = getSuggestions().filter(s => s.toLowerCase().includes(val)).slice(0, 8);
      if (!matches.length) { list.classList.remove('show'); return; }

      list.innerHTML = matches.map(m => {
        const idx = m.toLowerCase().indexOf(val);
        const highlighted = m.slice(0, idx) + '<mark>' + m.slice(idx, idx + val.length) + '</mark>' + m.slice(idx + val.length);
        return `<div class="autocomplete-item">${highlighted}</div>`;
      }).join('');
      list.classList.add('show');
      activeIdx = -1;

      list.querySelectorAll('.autocomplete-item').forEach((item, i) => {
        item.addEventListener('click', () => {
          input.value = matches[i];
          list.classList.remove('show');
          page = 1;
          loadJobs();
        });
      });
    });

    input.addEventListener('keydown', e => {
      const items = list.querySelectorAll('.autocomplete-item');
      if (!list.classList.contains('show') || !items.length) return;

      if (e.key === 'ArrowDown') {
        e.preventDefault();
        activeIdx = Math.min(activeIdx + 1, items.length - 1);
        items.forEach((it, i) => it.classList.toggle('active', i === activeIdx));
      } else if (e.key === 'ArrowUp') {
        e.preventDefault();
        activeIdx = Math.max(activeIdx - 1, 0);
        items.forEach((it, i) => it.classList.toggle('active', i === activeIdx));
      } else if (e.key === 'Enter' && activeIdx >= 0) {
        e.preventDefault();
        input.value = items[activeIdx].textContent;
        list.classList.remove('show');
        page = 1;
        loadJobs();
      } else if (e.key === 'Escape') {
        list.classList.remove('show');
      }
    });

    input.addEventListener('blur', () => { setTimeout(() => list.classList.remove('show'), 150); });
  }

  // ── Chip toggle ─────────────────────────────
  document.querySelectorAll('.chip').forEach(chip => {
    const input = chip.querySelector('input');
    input.addEventListener('change', () => {
      chip.classList.toggle('active', input.checked);
      page = 1;
      loadJobs();
    });
  });

  // ── Enter on filters ──────────────────────────
  document.querySelectorAll('.filter-input').forEach(el => {
    el.addEventListener('keydown', e => { if (e.key === 'Enter') { page = 1; loadJobs(); } });
  });
  document.getElementById('filter-btn').addEventListener('click', () => { page = 1; loadJobs(); });
  document.getElementById('clear-btn').addEventListener('click', () => {
    document.getElementById('filter-role').value = '';
    document.getElementById('filter-location').value = '';
    document.getElementById('filter-salary').value = '';
    document.getElementById('filter-source').value = '';
    document.querySelectorAll('.chip').forEach(c => { c.classList.remove('active'); c.querySelector('input').checked = false; });
    salaryFilter = 'all';
    document.getElementById('salary-filter').classList.remove('active');
    document.getElementById('salary-filter').title = 'Click to show only jobs with salary';
    page = 1;
    loadJobs();
  });

  // ── Tab click handlers ──────────────────────
  document.getElementById('tab-all').addEventListener('click', () => {
    viewMode = 'all';
    document.getElementById('tab-all').classList.add('active');
    document.getElementById('tab-saved').classList.remove('active');
    page = 1;
    loadJobs();
  });
  document.getElementById('tab-saved').addEventListener('click', () => {
    viewMode = 'saved';
    document.getElementById('tab-saved').classList.add('active');
    document.getElementById('tab-all').classList.remove('active');
    page = 1;
    loadJobs();
  });

  // ── Browse link smooth scroll ────────────────────
  document.getElementById('browse-link').addEventListener('click', (e) => {
    e.preventDefault();
    document.getElementById('listings').scrollIntoView({ behavior: 'smooth', block: 'start' });
  });

  // ── Navigation handlers ────────────────────────
  document.getElementById('nav-jobs').addEventListener('click', () => {
    document.getElementById('nav-jobs').classList.add('active');
    document.getElementById('nav-analytics').classList.remove('active');
    document.getElementById('jobs-view').classList.add('active');
    document.getElementById('analytics-view').classList.remove('active');
  });

  document.getElementById('nav-analytics').addEventListener('click', () => {
    document.getElementById('nav-analytics').classList.add('active');
    document.getElementById('nav-jobs').classList.remove('active');
    document.getElementById('analytics-view').classList.add('active');
    document.getElementById('jobs-view').classList.remove('active');
    // Lazy load analytics on first view
    if (!analyticsLoaded) {
      loadInsights();
      analyticsLoaded = true;
    }
  });

  // ── Bookmark click delegation ─────────────────
  document.getElementById('jobs-list').addEventListener('click', async (e) => {
    const btn = e.target.closest('.bookmark-btn');
    if (!btn) return;
    e.preventDefault();
    e.stopPropagation();
    const id = Number(btn.dataset.id);
    const wasSaved = isSaved(id);
    // Optimistic UI update
    btn.classList.toggle('saved');
    btn.title = wasSaved ? 'Save this job' : 'Remove from saved';
    // Pulse animation
    btn.classList.remove('pulse-anim');
    void btn.offsetWidth; // reflow to restart animation
    btn.classList.add('pulse-anim');
    // Persist to Supabase
    await toggleSaved(id);
    // If in saved view and we just unsaved, reload to remove from list
    if (viewMode === 'saved' && wasSaved) {
      loadJobs();
    }
  });

  // Salary column filter (cycles: all -> has -> none -> all)
  document.getElementById('salary-filter').addEventListener('click', () => {
    const el = document.getElementById('salary-filter');
    if (salaryFilter === 'all') {
      salaryFilter = 'has';
      el.classList.add('active');
      el.innerHTML = 'With Salary <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>';
      el.title = 'Showing jobs with salary. Click to show jobs without salary.';
    } else if (salaryFilter === 'has') {
      salaryFilter = 'none';
      el.innerHTML = 'No Salary <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>';
      el.title = 'Showing jobs without salary. Click to show all jobs.';
    } else {
      salaryFilter = 'all';
      el.classList.remove('active');
      el.innerHTML = 'Salary <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 4h13M3 8h9m-9 4h6m4 0l4 4m0 0l4-4m-4 4V4"/></svg>';
      el.title = 'Click to show only jobs with salary';
    }
    page = 1;
    loadJobs();
  });
  document.getElementById('prev-page').addEventListener('click', () => { if (page > 1) { page--; loadJobs(); } });
  document.getElementById('next-page').addEventListener('click', () => { page++; loadJobs(); });

  // ── Get selected chips ───────────────────────
  function getSelectedChips(containerId) {
    const chips = document.querySelectorAll(`#${containerId} .chip.active input`);
    const values = [];
    chips.forEach(c => values.push(...c.value.split(',')));
    return values;
  }

  // ── Jobs Table ────────────────────────────────
  async function loadJobs() {
    const role = document.getElementById('filter-role').value.trim();
    const loc = document.getElementById('filter-location').value.trim();
    const sal = document.getElementById('filter-salary').value;
    const src = document.getElementById('filter-source').value;
    const seniority = getSelectedChips('seniority-chips');
    const roleTypes = getSelectedChips('role-chips');
    const workTypes = getSelectedChips('worktype-chips');

    // Saved view: short-circuit if nothing saved
    if (viewMode === 'saved' && savedIds.size === 0) {
      document.getElementById('jobs-list').innerHTML = '<div class="no-results">No saved jobs yet — click the bookmark icon to save listings</div>';
      updatePag(0, 1);
      document.getElementById('results-count').textContent = '0 results';
      return;
    }

    let f = 'is_active=eq.true&order=last_seen.desc';
    if (viewMode === 'saved') {
      f += `&id=in.(${[...savedIds].join(',')})`;
    }
    if (src) f += `&source=eq.${src}`;
    if (loc) f += `&location=ilike.*${encodeURIComponent(loc)}*`;
    if (role) f += `&or=(title.ilike.*${encodeURIComponent(role)}*,tags.cs.["${role}"])`;
    if (sal) f += `&salary_min=gte.${sal}`;

    // Seniority filter (OR within group)
    if (seniority.length) {
      const seniorityOr = seniority.map(s => `title.ilike.*${s}*`).join(',');
      f += `&or=(${seniorityOr})`;
    }

    // Role type filter (OR within group)
    if (roleTypes.length) {
      const roleOr = roleTypes.map(r => `title.ilike.*${encodeURIComponent(r)}*`).join(',');
      f += `&or=(${roleOr})`;
    }

    // Work type filter
    if (workTypes.length === 1) {
      if (workTypes[0] === 'remote') {
        f += '&or=(source.in.(remoteok,jobicy),location.ilike.*remote*)';
      } else if (workTypes[0] === 'hybrid') {
        f += '&location=ilike.*hybrid*';
      } else if (workTypes[0] === 'onsite') {
        f += '&source=eq.arbeitnow&not.location=ilike.*remote*';
      }
    } else if (workTypes.length > 1) {
      // Multiple work types - build OR conditions
      const wtConds = [];
      if (workTypes.includes('remote')) wtConds.push('source.in.(remoteok,jobicy)', 'location.ilike.*remote*');
      if (workTypes.includes('hybrid')) wtConds.push('location.ilike.*hybrid*');
      if (workTypes.includes('onsite')) wtConds.push('and(source.eq.arbeitnow,not.location.ilike.*remote*)');
      if (wtConds.length) f += `&or=(${wtConds.join(',')})`;
    }

    // Salary info filter (from column header)
    if (salaryFilter === 'has') {
      f += '&or=(salary_min.not.is.null,salary_max.not.is.null)';
    } else if (salaryFilter === 'none') {
      f += '&salary_min=is.null&salary_max=is.null';
    }

    const off = (page - 1) * PAGE_SIZE;
    try {
      const res = await fetch(
        `${SB}/rest/v1/job_listings?${f}&select=id,external_id,source,title,company,location,salary_min,salary_max,currency,tags,url`,
        { headers: { ...H, 'Prefer': 'count=exact', 'Range': `${off}-${off + PAGE_SIZE - 1}` } }
      );
      const data = await res.json();
      const total = parseInt(res.headers.get('content-range')?.split('/')[1] || '0');
      renderTable(data);
      updatePag(total, page);
      // Update hero stats
      if (viewMode === 'all' && !role && !loc && !sal && !src && !seniority.length && !roleTypes.length && !workTypes.length && salaryFilter === 'all') {
        document.getElementById('hero-total').textContent = total.toLocaleString();
      }
      document.getElementById('results-count').textContent = `${total.toLocaleString()} results`;
    } catch (e) { console.error(e); }
  }

  function renderTable(jobs) {
    const list = document.getElementById('jobs-list');
    if (!jobs.length) {
      list.innerHTML = '<div class="no-results">No listings match your filters</div>';
      return;
    }
    list.innerHTML = jobs.map(j => {
      const sal = fmtSal(j.salary_min, j.salary_max, j.currency);
      const title = esc(titleCase(decodeHtml(j.title)));
      const company = esc(titleCase(decodeHtml(j.company)));
      const rawLoc = decodeHtml(j.location) || '';
      const loc = esc(titleCase(rawLoc) || '—');
      const hasSalary = j.salary_min || j.salary_max;
      const tags = (j.tags || []).slice(0, 2).map(t => `<span class="tag">${esc(fmtTag(t))}</span>`).join('');
      const url = j.url || '#';
      const workType = getWorkType(rawLoc, j.source, j.tags);

      const saved = isSaved(j.id);
      return `<a href="${url}" target="_blank" rel="noopener" class="job-card">
        <button class="bookmark-btn${saved ? ' saved' : ''}" data-id="${j.id}" title="${saved ? 'Remove from saved' : 'Save this job'}">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21l-7-5-7 5V5a2 2 0 012-2h10a2 2 0 012 2z"/></svg>
        </button>
        <div class="job-main">
          <div class="job-title">${title}</div>
          <span class="job-company">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 21h18M9 8h1M9 12h1M9 16h1M14 8h1M14 12h1M14 16h1M5 21V5a2 2 0 012-2h10a2 2 0 012 2v16"/></svg>
            ${company}
          </span>
        </div>
        <div class="job-location">
          <span class="job-location-text">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/><circle cx="12" cy="10" r="3"/></svg>
            ${loc}
          </span>
          ${workTypeBadge(workType)}
        </div>
        <div class="job-tags">${tags || '<span class="tag" style="opacity:0.3">—</span>'}</div>
        <span class="job-salary${hasSalary ? '' : ' none'}">${sal}</span>
        <span class="job-source ${j.source}">${fmtSource(j.source)}</span>
        <div class="job-arrow">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
        </div>
      </a>`;
    }).join('');
  }

  function updatePag(total, p) {
    const mx = Math.max(1, Math.ceil(total / PAGE_SIZE));
    document.getElementById('page-info').textContent = `Page ${p} of ${mx}`;
    document.getElementById('prev-page').disabled = p <= 1;
    document.getElementById('next-page').disabled = p >= mx;
  }

  function fmtSal(mn, mx, cur) {
    if (!mn && !mx) return '—';
    const f = n => `${(n / 1000).toFixed(0)}k`;
    const s = cur === 'EUR' ? '\u20ac' : cur === 'GBP' ? '\u00a3' : '$';
    if (mn && mx && mn !== mx) return `${s}${f(mn)} – ${s}${f(mx)}`;
    return `${s}${f(mn || mx)}`;
  }

  function esc(s) { if (!s) return ''; const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }

  function titleCase(s) {
    if (!s) return '';
    const minor = new Set(['a','an','the','and','or','but','in','on','at','to','for','of','with','by','from','as']);
    return s.split(' ').map((w, i) => {
      const lo = w.toLowerCase();
      if (i > 0 && minor.has(lo)) return lo;
      if (w === w.toUpperCase() && w.length <= 5) return w; // keep acronyms like "AI", "AWS"
      return lo.charAt(0).toUpperCase() + lo.slice(1);
    }).join(' ');
  }

  function fmtTag(t) {
    if (!t) return '';
    const up = t.trim();
    // Keep short acronyms uppercase
    if (up.length <= 4 && up === up.toUpperCase()) return up;
    return up.charAt(0).toUpperCase() + up.slice(1);
  }

  function fmtSource(s) {
    const map = { remoteok: 'RemoteOK', arbeitnow: 'Arbeitnow', jobicy: 'Jobicy' };
    return map[s] || s;
  }

  function getWorkType(location, source, tags) {
    const loc = (location || '').toLowerCase();
    const allTags = (tags || []).map(t => t.toLowerCase()).join(' ');
    const combined = loc + ' ' + allTags;

    // RemoteOK and Jobicy are remote-first boards
    if (source === 'remoteok' || source === 'jobicy') return 'remote';

    // Check for hybrid indicators
    if (combined.includes('hybrid')) return 'hybrid';

    // Check for remote indicators
    if (combined.includes('remote') || combined.includes('worldwide') || combined.includes('anywhere')) return 'remote';

    // Check for on-site indicators
    if (combined.includes('on-site') || combined.includes('onsite') || combined.includes('in-office')) return 'onsite';

    // Default: if has specific city/country, likely on-site
    if (loc && !loc.includes('remote') && loc.length > 2) return 'onsite';

    return 'remote'; // Default for job boards
  }

  function workTypeBadge(type) {
    const icons = {
      remote: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>',
      hybrid: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>',
      onsite: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>'
    };
    const labels = { remote: 'Remote', hybrid: 'Hybrid', onsite: 'On-site' };
    return `<span class="work-type ${type}">${icons[type]}${labels[type]}</span>`;
  }

  // ── Insights (Lazy loaded) ──────────────────────────────────
  async function loadInsights() {
    try {
      const res = await q('job_listings', 'is_active=eq.true&select=tags,salary_min,salary_max,company,source');
      const all = await res.json();

      // Sources breakdown doughnut
      const srcCounts = {};
      all.forEach(l => { srcCounts[l.source] = (srcCounts[l.source] || 0) + 1; });
      renderDoughnut(srcCounts);

      // Companies
      const compCounts = {};
      all.forEach(l => { compCounts[l.company] = (compCounts[l.company] || 0) + 1; });
      const topComp = Object.entries(compCounts).sort((a, b) => b[1] - a[1]).slice(0, 8);
      renderList('top-companies-list', topComp);

      // Tags — filter out generic/location terms that aren't skills
      const skipTags = new Set(['remote','remote work','worldwide','anywhere','full-time','part-time','contract','freelance','hybrid','onsite','on-site','other','n/a','intern','internship']);
      const tagCounts = {};
      all.forEach(l => (l.tags || []).forEach(t => { const k = t.toLowerCase().trim(); if (!skipTags.has(k) && k.length > 1) tagCounts[k] = (tagCounts[k] || 0) + 1; }));
      const topTags = Object.entries(tagCounts).sort((a, b) => b[1] - a[1]).slice(0, 8);
      renderList('top-tags-list', topTags);

      // Salary
      const bk = { '0–50k': 0, '50–80k': 0, '80–120k': 0, '120–160k': 0, '160–200k': 0, '200k+': 0 };
      all.forEach(l => {
        const s = l.salary_min || l.salary_max;
        if (!s) return;
        if (s < 50000) bk['0–50k']++;
        else if (s < 80000) bk['50–80k']++;
        else if (s < 120000) bk['80–120k']++;
        else if (s < 160000) bk['120–160k']++;
        else if (s < 200000) bk['160–200k']++;
        else bk['200k+']++;
      });
      renderSalary(bk);

      // Scrape history
      const hRes = await q('scrape_runs', 'status=eq.completed&order=started_at.desc&limit=30&select=source,started_at,quality_score,total_count,added_count,removed_count');
      const hist = await hRes.json();
      renderHistory(hist);
    } catch (e) { console.error(e); }
  }

  function renderList(id, items) {
    const ul = document.getElementById(id);
    const isTags = id.includes('tags');
    ul.innerHTML = items.map(([label, count], i) =>
      `<li><span class="rank">${i + 1}</span><span class="label">${esc(isTags ? fmtTag(label) : titleCase(label))}</span><span class="value">${count}</span></li>`
    ).join('');
  }

  // Chart config (light mode)
  const gridColor = 'rgba(0,0,0,0.06)';
  const tickColor = '#5a5a72';
  const baseOpts = {
    responsive: true, maintainAspectRatio: false,
    plugins: { legend: { display: false } },
    scales: {
      x: { ticks: { color: tickColor, font: { size: 11, family: 'Inter' } }, grid: { color: gridColor } },
      y: { ticks: { color: tickColor, font: { size: 11, family: 'Inter' } }, grid: { color: gridColor } },
    },
  };

  function renderDoughnut(srcCounts) {
    const ctx = document.getElementById('sources-doughnut');
    if (doughnutChart) doughnutChart.destroy();
    const labels = Object.keys(srcCounts).map(fmtSource);
    const colors = ['#6366f1', '#22c55e', '#f97316', '#06b6d4', '#a855f7'];
    doughnutChart = new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels,
        datasets: [{ data: Object.values(srcCounts), backgroundColor: colors.slice(0, labels.length), borderWidth: 0, hoverOffset: 6 }],
      },
      options: {
        responsive: true, maintainAspectRatio: true, cutout: '65%',
        plugins: {
          legend: { display: true, position: 'bottom', labels: { color: tickColor, font: { size: 12, family: 'Inter' }, padding: 12, usePointStyle: true, pointStyleWidth: 8 } },
        },
      },
    });
  }

  function renderSalary(bk) {
    const ctx = document.getElementById('salary-chart');
    if (salaryChart) salaryChart.destroy();
    const gradient = ctx.getContext('2d').createLinearGradient(0, 0, 0, 250);
    gradient.addColorStop(0, 'rgba(34,197,94,0.5)');
    gradient.addColorStop(1, 'rgba(34,197,94,0.05)');
    salaryChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: Object.keys(bk),
        datasets: [{ data: Object.values(bk), backgroundColor: gradient, borderColor: 'rgba(34,197,94,0.6)', borderWidth: 1, borderRadius: 6 }],
      },
      options: baseOpts,
    });
  }

  function renderHistory(hist) {
    const ctx = document.getElementById('history-chart');
    if (historyChart) historyChart.destroy();
    const sorted = [...hist].reverse();
    historyChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: sorted.map(h => new Date(h.started_at).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })),
        datasets: [
          { label: 'Added', data: sorted.map(h => h.added_count), borderColor: '#22c55e', backgroundColor: 'rgba(34,197,94,0.08)', fill: true, tension: 0.4, pointRadius: 3, pointBackgroundColor: '#22c55e' },
          { label: 'Removed', data: sorted.map(h => h.removed_count), borderColor: '#ef4444', backgroundColor: 'rgba(239,68,68,0.08)', fill: true, tension: 0.4, pointRadius: 3, pointBackgroundColor: '#ef4444' },
        ],
      },
      options: { ...baseOpts, plugins: { legend: { display: true, labels: { color: tickColor, font: { size: 12, family: 'Inter' }, usePointStyle: true, pointStyleWidth: 8 } } } },
    });
  }

  // ── Init ──────────────────────────────────────
  (async () => {
    await initAuth();
    loadJobs();
    loadSuggestions().then(() => {
      setupAutocomplete('filter-role', 'role-suggestions', () => allRoles);
      setupAutocomplete('filter-location', 'location-suggestions', () => allLocations);
    });
  })();
})();
</script>
</body>
</html>
